<mxfile host="app.diagrams.net" modified="2024-06-04T16:20:09.782Z" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2.1 Safari/605.1.15" etag="Sn-KXdQaeIevNdCnniFQ" version="24.4.13" type="github" pages="5">
  <diagram name="live" id="U2sys6m2P0nSdcJm8TKS">
    <mxGraphModel dx="2960" dy="867" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-2" target="x6Jtk6zeUvlKm-oWEQXY-118" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-2" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-592" y="870" width="610" height="392" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-5" target="x6Jtk6zeUvlKm-oWEQXY-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="120" y="880" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-5" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-502" y="560" width="430" height="250" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-7" target="x6Jtk6zeUvlKm-oWEQXY-111" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-7" value="连接管理服务" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="730" y="390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-10" target="x6Jtk6zeUvlKm-oWEQXY-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-9" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;单播/广播&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-8" vertex="1" connectable="0">
          <mxGeometry x="0.0166" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-10" value="推送逻辑服务" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="414" y="390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-15" target="x6Jtk6zeUvlKm-oWEQXY-35" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-12" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;组播-房间成员列表&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-11" vertex="1" connectable="0">
          <mxGeometry x="0.1596" y="2" relative="1" as="geometry">
            <mxPoint x="-1" y="-2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-13" value="解决千万级别消息扩散" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-15" target="x6Jtk6zeUvlKm-oWEQXY-112" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-15" target="x6Jtk6zeUvlKm-oWEQXY-129" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-15" value="消息投递服务" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="20" y="390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-18" target="x6Jtk6zeUvlKm-oWEQXY-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-17" value="单个uid路由到一台机器上&lt;br&gt;缓存命中高" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-16" vertex="1" connectable="0">
          <mxGeometry x="0.2806" y="-1" relative="1" as="geometry">
            <mxPoint y="52" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-18" value="" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;rotation=90;" parent="1" vertex="1">
          <mxGeometry x="250" y="515" width="60" height="150" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-15" target="x6Jtk6zeUvlKm-oWEQXY-18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-20" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;可靠消息/非可靠消息&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-19" vertex="1" connectable="0">
          <mxGeometry x="0.0146" y="3" relative="1" as="geometry">
            <mxPoint y="14" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-21" value="根据uid分key投递" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-19" vertex="1" connectable="0">
          <mxGeometry x="-0.4862" y="-2" relative="1" as="geometry">
            <mxPoint y="23" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-22" value="消息队列" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="240" y="575" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-23" value="" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-457" y="610" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-24" value="成员set" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-447" y="620" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-25" value="" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-357" y="720" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-26" value="成员set" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-347" y="730" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-27" value="" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-247" y="605" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-28" value="成员set" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-237" y="615" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-29" value="成员列表服务" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="-502" y="560" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-30" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-35" target="x6Jtk6zeUvlKm-oWEQXY-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-31" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;房间路由&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-30" vertex="1" connectable="0">
          <mxGeometry x="-0.0249" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-35" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-30" y="680" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-33" value="可能成为性能瓶颈" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-32" vertex="1" connectable="0">
          <mxGeometry x="0.1599" y="-2" relative="1" as="geometry">
            <mxPoint x="5" y="151" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-34" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;dashed=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-35" target="x6Jtk6zeUvlKm-oWEQXY-96" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9cAvgB88gob5KMhP02BU-6" value="旁路只写，故障切换" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-34" vertex="1" connectable="0">
          <mxGeometry x="-0.0892" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-35" value="房间成员逻辑服务" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-347" y="390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-36" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;建连/心跳&lt;/span&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-39" target="x6Jtk6zeUvlKm-oWEQXY-7" edge="1">
          <mxGeometry x="0.0105" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-37" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.75;entryY=0;entryDx=0;entryDy=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-39" target="x6Jtk6zeUvlKm-oWEQXY-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-38" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;可靠消息上报确认&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-37" vertex="1" connectable="0">
          <mxGeometry x="-0.148" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-39" value="" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shadow=0;dashed=0;strokeWidth=1;shape=mxgraph.android.phone2;strokeColor=#c0c0c0;" parent="1" vertex="1">
          <mxGeometry x="769.48" y="210" width="41.03" height="80" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-40" value="redis" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" parent="1" vertex="1">
          <mxGeometry x="610" y="550" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-41" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0;entryDx=0;entryDy=27.5;entryPerimeter=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-7" target="x6Jtk6zeUvlKm-oWEQXY-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-42" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;维护uid和节点信息&lt;br&gt;（zset多设备）&lt;br&gt;ip:port-&amp;gt;ts&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-41" vertex="1" connectable="0">
          <mxGeometry x="0.3957" relative="1" as="geometry">
            <mxPoint x="44" y="-3" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-43" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-45" target="x6Jtk6zeUvlKm-oWEQXY-35" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-44" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;进退房：3w/s&lt;br&gt;心跳约10s一次：3w/s&lt;br&gt;&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-43" vertex="1" connectable="0">
          <mxGeometry x="-0.2642" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-45" value="" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shadow=0;dashed=0;strokeWidth=1;shape=mxgraph.android.phone2;strokeColor=#c0c0c0;" parent="1" vertex="1">
          <mxGeometry x="-307.51" y="210" width="41.03" height="80" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-46" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-48" target="x6Jtk6zeUvlKm-oWEQXY-15" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-47" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;单播/广播-普通路由&lt;br&gt;组播-roomid哈希路由&lt;br&gt;严格控制调用来源&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-46" vertex="1" connectable="0">
          <mxGeometry x="-0.0211" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-48" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-47.5" y="200" width="255" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-49" value="送礼" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-32.5" y="210" width="50" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-50" value="发言" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="27.5" y="210" width="50" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-51" value="pk" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="90" y="210" width="50" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-52" value="信令" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="147.5" y="210" width="50" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-53" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-10" target="x6Jtk6zeUvlKm-oWEQXY-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-54" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;cache miss或者失败&lt;br&gt;查询连接节点&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-53" vertex="1" connectable="0">
          <mxGeometry x="0.1519" relative="1" as="geometry">
            <mxPoint y="24" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-55" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-57" target="x6Jtk6zeUvlKm-oWEQXY-119" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-56" value="可靠消息列表&lt;br&gt;消息防重列表&lt;br&gt;zset" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-55" vertex="1" connectable="0">
          <mxGeometry x="-0.0843" relative="1" as="geometry">
            <mxPoint y="-1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-57" value="redis" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" parent="1" vertex="1">
          <mxGeometry x="444" y="550" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-58" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-10" target="x6Jtk6zeUvlKm-oWEQXY-57" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-59" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;可靠消息确认&lt;br&gt;非可靠消息防重&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-58" vertex="1" connectable="0">
          <mxGeometry x="-0.2642" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-60" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-554" y="892" width="430" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-61" value="uid1/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-554" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-62" value="uid2/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-492" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-63" value="uid3/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-430" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-64" value="uid4/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-369.99" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-65" value="....." style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-307.99" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-66" value="uid/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-245.99" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-67" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-69" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-42" y="912.0000000000002" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-68" value="异步落盘" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-67" vertex="1" connectable="0">
          <mxGeometry x="-0.0822" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-69" value="uid/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-186" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-70" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-320" y="1000" width="62" height="230" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-71" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-72" target="x6Jtk6zeUvlKm-oWEQXY-80" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-72" value="uid1" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-320" y="1000" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-73" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-74" target="x6Jtk6zeUvlKm-oWEQXY-81" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-74" value="uid2" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-320" y="1050" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-75" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-76" target="x6Jtk6zeUvlKm-oWEQXY-82" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-76" value="uid3" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-320" y="1110" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-77" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-78" target="x6Jtk6zeUvlKm-oWEQXY-83" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-78" value="uid4" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-320" y="1170" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-79" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.509;entryY=0.997;entryDx=0;entryDy=0;entryPerimeter=0;dashed=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-80" target="x6Jtk6zeUvlKm-oWEQXY-84" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-80" value="0" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-196" y="1015" width="31" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-81" value="1" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-196" y="1065" width="31" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-82" value="2" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-196" y="1125" width="31" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-83" value="3" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-196" y="1185" width="31" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-84" value="0" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="-537" y="930" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-85" value="1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="-467" y="930" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-86" value="2" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="-407" y="930" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-87" value="3" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="-347" y="930" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-88" value="10w" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="-187" y="930" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-89" value="存储设计" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="-72" y="1222" width="90" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-90" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-502" y="1000" width="62" height="230" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-91" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-92" target="x6Jtk6zeUvlKm-oWEQXY-72" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-92" value="roomid1" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-502" y="1000" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-93" value="roomid2" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-502" y="1050" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-94" value="..." style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-502" y="1110" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-95" value="roomidN" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-502" y="1170" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-96" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;" parent="1" vertex="1">
          <mxGeometry x="-1050" y="560" width="430" height="250" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-97" value="" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-1005" y="610" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-98" value="成员set" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-995" y="620" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-99" value="" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-905" y="720" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-100" value="成员set" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-895" y="730" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-101" value="" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-795" y="605" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-102" value="成员set" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-785" y="615" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-103" value="成员列表服务&lt;br&gt;异地容灾" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="-1050" y="560" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-104" value="PCU：30w&lt;br&gt;DAU：420w&lt;br&gt;单房间最大：10w&lt;br&gt;日活主播：4w" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#82b366;fillColor=#d5e8d4;" parent="1" vertex="1">
          <mxGeometry x="-347" y="100" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-105" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-107" target="x6Jtk6zeUvlKm-oWEQXY-35" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-106" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;其他读：5w/s&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-105" vertex="1" connectable="0">
          <mxGeometry x="-0.1057" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-107" value="其他服务" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-582" y="390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-108" value="单房间最多10w用户&lt;br&gt;&lt;span style=&quot;text-wrap: nowrap;&quot;&gt;单机&lt;/span&gt;&lt;div style=&quot;text-wrap: nowrap;&quot;&gt;2w/s写&lt;br&gt;1.5w/s读&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="-192" y="750" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-109" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-110" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1170" y="715" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-110" value="&lt;ol&gt;&lt;li&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;gonet-&amp;gt;tnet网络模型优化&lt;/span&gt;&lt;br&gt;&lt;/li&gt;&lt;li&gt;内存下降45%&lt;/li&gt;&lt;li&gt;cpu下降20%&lt;/li&gt;&lt;li&gt;单机连接数提升100%&lt;/li&gt;&lt;/ol&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="1" vertex="1">
          <mxGeometry x="860" y="670" width="200" height="90" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-111" value="优化：连接层支持组播方案&lt;br&gt;解决超大直播间网卡瓶颈" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="1" vertex="1">
          <mxGeometry x="980" y="400" width="170" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-112" value="1.单房间消息合并&lt;br&gt;2.消息分级，消息丢弃&lt;br&gt;3.超大房间限流，降级丢弃" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="1" vertex="1">
          <mxGeometry x="-12" y="545" width="170" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-113" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;全量拉取，100w房间，目前最大10w&lt;/span&gt;&lt;/div&gt;&lt;div&gt;数据量8mb，千兆网卡最大qps=1000/8/8=15qps&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="1" vertex="1">
          <mxGeometry x="-60" y="690" width="280" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-114" value="" style="sketch=0;pointerEvents=1;shadow=0;dashed=0;html=1;strokeColor=none;fillColor=#505050;labelPosition=center;verticalLabelPosition=bottom;verticalAlign=top;outlineConnect=0;align=center;shape=mxgraph.office.devices.hard_disk;" parent="1" vertex="1">
          <mxGeometry x="-40" y="885" width="40" height="54" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-115" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0.504;entryY=0.015;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-7" target="x6Jtk6zeUvlKm-oWEQXY-110" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-116" value="oom排查和优化" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="1" vertex="1">
          <mxGeometry x="65" y="885" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-117" value="&lt;ol&gt;&lt;li&gt;原有模型压测：单机50w，7G内存&lt;/li&gt;&lt;li&gt;升级后压测：单机50w，4G&lt;/li&gt;&lt;li&gt;压测百万连接&lt;/li&gt;&lt;/ol&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="1" vertex="1">
          <mxGeometry x="1100" y="675" width="250" height="80" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-118" value="&lt;ol&gt;&lt;li&gt;碎片整理&lt;/li&gt;&lt;li&gt;支持持久化，快速重启&lt;/li&gt;&lt;/ol&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="1" vertex="1">
          <mxGeometry x="65" y="1031" width="180" height="70" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-119" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="446" y="740" width="54" height="250" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-120" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-121" target="x6Jtk6zeUvlKm-oWEQXY-123" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-121" value="msgid" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="446" y="740" width="54" height="50" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-122" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-123" target="x6Jtk6zeUvlKm-oWEQXY-128" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-123" value="status&amp;lt;&amp;lt;32+ts&lt;br&gt;status=0 未确认&lt;div&gt;statue=1 确认&lt;/div&gt;&lt;div&gt;status=2 丢弃/非可靠消息&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="540" y="725" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-124" value="msgid" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="446" y="790" width="54" height="50" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-125" value="msgid" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="446" y="840" width="54" height="50" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-126" value="msgid" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="446" y="890" width="54" height="50" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-127" value="msgid" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="446" y="940" width="54" height="50" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-128" value="快速筛选：&lt;div&gt;小于1&amp;lt;&amp;lt;32 就是未确认的消息，还能进一步根据时间筛选，进行重发&lt;/div&gt;&lt;div&gt;大于1&amp;gt;&amp;gt;32 的定期删除，防止列表过大&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="1" vertex="1">
          <mxGeometry x="534" y="855" width="380" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-129" value="雪花算法id生成" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="1" vertex="1">
          <mxGeometry x="175" y="370" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-130" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="205" y="350" width="185" height="20" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-131" value="时间戳ms" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="205" y="350" width="65" height="20" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-132" value="机器" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="270" y="350" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-133" value="incr" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="350" y="350" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-134" value="41" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="217.5" y="320" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-135" value="8" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="282.5" y="320" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-136" value="12" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="355" y="320" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-137" value="时间线" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="310" y="350" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-138" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-139" target="x6Jtk6zeUvlKm-oWEQXY-142" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-139" value="2" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="320" y="320" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-140" value="0" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="175" y="350" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-141" value="1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="175" y="320" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-142" value="解决时钟回拨" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="1" vertex="1">
          <mxGeometry x="285" y="268" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="lPl_-dJKi4ZWcJyu0Dkh-1" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="970" y="200" width="500" height="30" as="geometry" />
        </mxCell>
        <mxCell id="lPl_-dJKi4ZWcJyu0Dkh-2" value="magic" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="970" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="lPl_-dJKi4ZWcJyu0Dkh-3" value="len" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1020" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="lPl_-dJKi4ZWcJyu0Dkh-4" value="头len" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1070" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="lPl_-dJKi4ZWcJyu0Dkh-5" value="编码" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1120" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="lPl_-dJKi4ZWcJyu0Dkh-7" value="压缩" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1170" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="lPl_-dJKi4ZWcJyu0Dkh-8" value="加密" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1220" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="lPl_-dJKi4ZWcJyu0Dkh-9" value="..." style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1270" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="lPl_-dJKi4ZWcJyu0Dkh-10" value="数据" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1370" y="200" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="lPl_-dJKi4ZWcJyu0Dkh-11" value="协议重要字段" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="865" y="200" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="lPl_-dJKi4ZWcJyu0Dkh-12" value="头扩展" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1320" y="200" width="50" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="live 的副本" id="hugfhMHL9A4iMEHUzqtO">
    <mxGraphModel dx="3190" dy="1020" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-0" />
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-1" parent="bxa8RqcD89XLqhrJgpsZ-0" />
        <mxCell id="prOLGn9-0uz1F6Hl3zky-15" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="65" y="1860" width="395" height="350" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-3" target="bxa8RqcD89XLqhrJgpsZ-121" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-3" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-592" y="870" width="610" height="392" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-6" target="bxa8RqcD89XLqhrJgpsZ-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="120" y="880" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-6" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-502" y="560" width="430" height="250" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-8" target="bxa8RqcD89XLqhrJgpsZ-114" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-8" value="连接管理服务" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="730" y="390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-11" target="bxa8RqcD89XLqhrJgpsZ-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-10" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;单播/广播&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-9" vertex="1" connectable="0">
          <mxGeometry x="0.0166" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-11" value="推送逻辑服务" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="414" y="390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-17" target="bxa8RqcD89XLqhrJgpsZ-38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-13" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;组播-房间成员列表&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-12" vertex="1" connectable="0">
          <mxGeometry x="0.1596" y="2" relative="1" as="geometry">
            <mxPoint x="-1" y="-2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-14" value="解决千万级别消息扩散" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-17" target="bxa8RqcD89XLqhrJgpsZ-115" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-17" target="bxa8RqcD89XLqhrJgpsZ-132" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.25;exitDx=0;exitDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-17" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-90" y="106" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-17" value="消息投递服务" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="20" y="390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-20" target="bxa8RqcD89XLqhrJgpsZ-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-19" value="单个uid路由到一台机器上&lt;br&gt;缓存命中高" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-18" vertex="1" connectable="0">
          <mxGeometry x="0.2806" y="-1" relative="1" as="geometry">
            <mxPoint y="52" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-20" value="" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;rotation=90;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="250" y="515" width="60" height="150" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-21" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-17" target="bxa8RqcD89XLqhrJgpsZ-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-22" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;可靠消息/非可靠消息&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-21" vertex="1" connectable="0">
          <mxGeometry x="0.0146" y="3" relative="1" as="geometry">
            <mxPoint y="14" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-23" value="根据uid分key投递" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-21" vertex="1" connectable="0">
          <mxGeometry x="-0.4862" y="-2" relative="1" as="geometry">
            <mxPoint y="23" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-24" value="消息队列" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="240" y="575" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-25" value="" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-457" y="610" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-26" value="成员set" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-447" y="620" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-27" value="" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-357" y="720" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-28" value="成员set" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-347" y="730" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-29" value="" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-247" y="605" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-30" value="成员set" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-237" y="615" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-31" value="成员列表服务" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-502" y="560" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-38" target="bxa8RqcD89XLqhrJgpsZ-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-33" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;房间路由&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-32" vertex="1" connectable="0">
          <mxGeometry x="-0.0249" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-34" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-38" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-30" y="680" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-35" value="可能成为性能瓶颈" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-34" vertex="1" connectable="0">
          <mxGeometry x="0.1599" y="-2" relative="1" as="geometry">
            <mxPoint x="5" y="151" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-36" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;dashed=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-38" target="bxa8RqcD89XLqhrJgpsZ-99" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-37" value="旁路只写，故障切换" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-36" vertex="1" connectable="0">
          <mxGeometry x="-0.0892" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-38" value="房间成员逻辑服务" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-347" y="390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-39" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;建连/心跳&lt;/span&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-42" target="bxa8RqcD89XLqhrJgpsZ-8" edge="1">
          <mxGeometry x="0.0105" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-40" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.75;entryY=0;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-42" target="bxa8RqcD89XLqhrJgpsZ-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-41" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;可靠消息上报确认&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-40" vertex="1" connectable="0">
          <mxGeometry x="-0.148" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-42" value="" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shadow=0;dashed=0;strokeWidth=1;shape=mxgraph.android.phone2;strokeColor=#c0c0c0;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="769.48" y="210" width="41.03" height="80" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-43" value="redis" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="610" y="550" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-44" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0;entryDx=0;entryDy=27.5;entryPerimeter=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-8" target="bxa8RqcD89XLqhrJgpsZ-43" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-45" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;维护uid和节点信息&lt;br&gt;（zset多设备）&lt;br&gt;ip:port-&amp;gt;ts&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-44" vertex="1" connectable="0">
          <mxGeometry x="0.3957" relative="1" as="geometry">
            <mxPoint x="44" y="-3" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-46" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-48" target="bxa8RqcD89XLqhrJgpsZ-38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-47" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;进退房：3w/s&lt;br&gt;心跳约10s一次：3w/s&lt;br&gt;&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-46" vertex="1" connectable="0">
          <mxGeometry x="-0.2642" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-48" value="" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shadow=0;dashed=0;strokeWidth=1;shape=mxgraph.android.phone2;strokeColor=#c0c0c0;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-307.51" y="210" width="41.03" height="80" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-49" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-51" target="bxa8RqcD89XLqhrJgpsZ-17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-50" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;单播/广播-普通路由&lt;br&gt;组播-roomid哈希路由&lt;br&gt;严格控制调用来源&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-49" vertex="1" connectable="0">
          <mxGeometry x="-0.0211" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-51" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-47.5" y="200" width="255" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-52" value="送礼" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-32.5" y="210" width="50" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-53" value="发言" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="27.5" y="210" width="50" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-54" value="pk" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="90" y="210" width="50" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-55" value="信令" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="147.5" y="210" width="50" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-56" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-11" target="bxa8RqcD89XLqhrJgpsZ-43" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-57" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;cache miss或者失败&lt;br&gt;查询连接节点&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-56" vertex="1" connectable="0">
          <mxGeometry x="0.1519" relative="1" as="geometry">
            <mxPoint y="24" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-58" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-60" target="bxa8RqcD89XLqhrJgpsZ-122" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-59" value="可靠消息列表&lt;br&gt;消息防重列表&lt;br&gt;zset" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-58" vertex="1" connectable="0">
          <mxGeometry x="-0.0843" relative="1" as="geometry">
            <mxPoint y="-1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-60" value="redis" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="444" y="550" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-61" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-11" target="bxa8RqcD89XLqhrJgpsZ-60" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-62" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;可靠消息确认&lt;br&gt;非可靠消息防重&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-61" vertex="1" connectable="0">
          <mxGeometry x="-0.2642" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-63" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-554" y="892" width="430" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-64" value="uid1/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-554" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-65" value="uid2/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-492" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-66" value="uid3/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-430" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-67" value="uid4/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-369.99" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-68" value="....." style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-307.99" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-69" value="uid/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-245.99" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-70" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-72" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-42" y="912.0000000000002" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-71" value="异步落盘" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-70" vertex="1" connectable="0">
          <mxGeometry x="-0.0822" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-72" value="uid/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-186" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-73" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-320" y="1000" width="62" height="230" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-74" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-75" target="bxa8RqcD89XLqhrJgpsZ-83" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-75" value="uid1" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-320" y="1000" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-76" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-77" target="bxa8RqcD89XLqhrJgpsZ-84" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-77" value="uid2" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-320" y="1050" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-78" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-79" target="bxa8RqcD89XLqhrJgpsZ-85" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-79" value="uid3" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-320" y="1110" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-80" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-81" target="bxa8RqcD89XLqhrJgpsZ-86" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-81" value="uid4" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-320" y="1170" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-82" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.509;entryY=0.997;entryDx=0;entryDy=0;entryPerimeter=0;dashed=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-83" target="bxa8RqcD89XLqhrJgpsZ-87" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-83" value="0" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-196" y="1015" width="31" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-84" value="1" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-196" y="1065" width="31" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-85" value="2" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-196" y="1125" width="31" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-86" value="3" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-196" y="1185" width="31" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-87" value="0" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-537" y="930" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-88" value="1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-467" y="930" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-89" value="2" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-407" y="930" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-90" value="3" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-347" y="930" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-91" value="10w" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-187" y="930" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-92" value="存储设计" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-72" y="1222" width="90" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-93" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-502" y="1000" width="62" height="230" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-94" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-95" target="bxa8RqcD89XLqhrJgpsZ-75" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-95" value="roomid1" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-502" y="1000" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-96" value="roomid2" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-502" y="1050" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-97" value="..." style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-502" y="1110" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-98" value="roomidN" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-502" y="1170" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-99" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-1050" y="560" width="430" height="250" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-100" value="" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-1005" y="610" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-101" value="成员set" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-995" y="620" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-102" value="" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-905" y="720" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-103" value="成员set" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-895" y="730" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-104" value="" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-795" y="605" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-105" value="成员set" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-785" y="615" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-106" value="成员列表服务&lt;br&gt;异地容灾" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-1050" y="560" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-107" value="PCU：30w&lt;br&gt;DAU：420w&lt;br&gt;单房间最大：10w&lt;br&gt;日活主播：4w" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#82b366;fillColor=#d5e8d4;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-347" y="100" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-108" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-110" target="bxa8RqcD89XLqhrJgpsZ-38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-109" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;其他读：5w/s&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-108" vertex="1" connectable="0">
          <mxGeometry x="-0.1057" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-110" value="其他服务" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-582" y="390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-111" value="单房间最多10w用户&lt;br&gt;&lt;span style=&quot;text-wrap: nowrap;&quot;&gt;单机&lt;/span&gt;&lt;div style=&quot;text-wrap: nowrap;&quot;&gt;2w/s写&lt;br&gt;1.5w/s读&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-192" y="750" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-112" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-113" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1170" y="715" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-113" value="&lt;ol&gt;&lt;li&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;gonet-&amp;gt;tnet网络模型优化&lt;/span&gt;&lt;br&gt;&lt;/li&gt;&lt;li&gt;内存下降45%&lt;/li&gt;&lt;li&gt;cpu下降20%&lt;/li&gt;&lt;li&gt;单机连接数提升100%&lt;/li&gt;&lt;/ol&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="860" y="670" width="200" height="90" as="geometry" />
        </mxCell>
        <mxCell id="V5EH8akgTNUjjNnxu9XO-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-114" target="V5EH8akgTNUjjNnxu9XO-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-114" value="优化：连接层支持组播方案&lt;br&gt;解决超大直播间网卡瓶颈" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="980" y="400" width="170" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-0" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-115" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="350" y="1090" as="targetPoint" />
            <Array as="points">
              <mxPoint x="73" y="650" />
              <mxPoint x="351" y="650" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-115" value="1.单房间消息合并&lt;br&gt;2.消息分级，消息丢弃&lt;br&gt;3.超大房间限流，降级丢弃" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-12" y="545" width="170" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-21" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-116" target="ZDgZF7WNOIpqBr-gDZdw-20" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="260" y="710" />
              <mxPoint x="260" y="1000" />
              <mxPoint x="990" y="1000" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-116" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;全量拉取，100w房间，目前最大10w&lt;/span&gt;&lt;/div&gt;&lt;div&gt;100w数据量8mb，千兆网卡最大qps=1000/8/8=15qps&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-60" y="690" width="310" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-117" value="" style="sketch=0;pointerEvents=1;shadow=0;dashed=0;html=1;strokeColor=none;fillColor=#505050;labelPosition=center;verticalLabelPosition=bottom;verticalAlign=top;outlineConnect=0;align=center;shape=mxgraph.office.devices.hard_disk;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-40" y="885" width="40" height="54" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-118" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0.504;entryY=0.015;entryDx=0;entryDy=0;entryPerimeter=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-8" target="bxa8RqcD89XLqhrJgpsZ-113" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.546;entryY=0.05;entryDx=0;entryDy=0;entryPerimeter=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-119" target="ZDgZF7WNOIpqBr-gDZdw-18" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-170" y="1460" as="targetPoint" />
            <Array as="points">
              <mxPoint x="50" y="900" />
              <mxPoint x="50" y="1502" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-119" value="oom排查和优化" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="65" y="885" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="V5EH8akgTNUjjNnxu9XO-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-120" target="V5EH8akgTNUjjNnxu9XO-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-120" value="&lt;ol&gt;&lt;li&gt;原有模型压测：单机50w，7G内存&lt;/li&gt;&lt;li&gt;升级后压测：单机50w，4G&lt;/li&gt;&lt;li&gt;压测百万连接&lt;/li&gt;&lt;/ol&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="1100" y="675" width="250" height="80" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-121" target="ZDgZF7WNOIpqBr-gDZdw-2" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="155" y="1210" />
              <mxPoint x="460" y="1210" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-121" value="&lt;ol&gt;&lt;li&gt;碎片整理&lt;/li&gt;&lt;li&gt;支持持久化，快速重启&lt;/li&gt;&lt;/ol&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="65" y="1031" width="180" height="70" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-122" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="446" y="740" width="54" height="250" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-123" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-124" target="bxa8RqcD89XLqhrJgpsZ-126" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-124" value="msgid" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="446" y="740" width="54" height="50" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-125" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-126" target="bxa8RqcD89XLqhrJgpsZ-131" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-126" value="status&amp;lt;&amp;lt;32+ts&lt;br&gt;status=0 未确认&lt;div&gt;statue=1 确认&lt;/div&gt;&lt;div&gt;status=2 丢弃/非可靠消息&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="540" y="725" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-127" value="msgid" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="446" y="790" width="54" height="50" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-128" value="msgid" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="446" y="840" width="54" height="50" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-129" value="msgid" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="446" y="890" width="54" height="50" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-130" value="msgid" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="446" y="940" width="54" height="50" as="geometry" />
        </mxCell>
        <mxCell id="e5ygJ3nNOSe9Yrahaoav-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-131" target="e5ygJ3nNOSe9Yrahaoav-0">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-131" value="快速筛选：&lt;div&gt;小于1&amp;lt;&amp;lt;32 就是未确认的消息，还能进一步根据时间筛选，进行重发&lt;/div&gt;&lt;div&gt;大于1&amp;gt;&amp;gt;32 的定期删除，防止列表过大&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="534" y="855" width="380" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-132" value="雪花算法id生成" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="175" y="370" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-133" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="205" y="350" width="185" height="20" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-134" value="时间戳ms" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="205" y="350" width="65" height="20" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-135" value="机器" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="270" y="350" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-136" value="incr" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="350" y="350" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-137" value="41" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="217.5" y="320" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-138" value="8" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="282.5" y="320" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-139" value="12" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="355" y="320" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-140" value="时间线" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="310" y="350" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-141" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-142" target="bxa8RqcD89XLqhrJgpsZ-145" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-142" value="2" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="320" y="320" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-143" value="0" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="175" y="350" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-144" value="1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="175" y="320" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-145" value="解决时钟回拨" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="285" y="268" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-146" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="970" y="200" width="500" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-147" value="magic" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="970" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-148" value="len" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="1020" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-149" value="头len" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="1070" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-150" value="编码" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="1120" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-151" value="压缩" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="1170" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-152" value="加密" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="1220" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-153" value="..." style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="1270" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-154" value="数据" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="1370" y="200" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-155" value="协议重要字段" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="865" y="200" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-156" value="头扩展" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="1320" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-157" value="&lt;div style=&quot;text-align: left;&quot;&gt;千兆网卡单房间：&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;最大：送礼消息128字节+发言256字节+其他128字节=512字节&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;512*10w*0.7压缩=350w字节=3.5MB&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-165" y="30" width="350" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-22" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="ZDgZF7WNOIpqBr-gDZdw-1" target="ZDgZF7WNOIpqBr-gDZdw-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-1" value="1.单房间合并：&lt;div&gt;组播消息上游调过来是通过roomid做的一致性hash路由&lt;/div&gt;&lt;div&gt;在服务内部会对单个房间的消息进行合并，2s内的消息合并，2s的定时任务进行推送&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2.消息分级：&lt;/div&gt;&lt;div&gt;针对送礼，进退房，发言，信令等消息，进行分级：信令&amp;gt;送礼&amp;gt;发言&amp;gt;进退房广播&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3.超过10w的房间，才会开启限流，进行丢弃，目前基本不会触发这个阈值&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;4.可靠消息，根据类型进行配置，上游不能控制，严格控制主调来源，防止广播风暴&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="295" y="1038" width="470" height="150" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="ZDgZF7WNOIpqBr-gDZdw-2" target="ZDgZF7WNOIpqBr-gDZdw-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-2" value="1.碎片整理：&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;出现原因：退房或者超时被清理，会导致数组出现空洞&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;有什么影响：不进行整理的话，会导致next指针一直往后移，内存占用上涨，而实际可能并没有很多人在房间内&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;如何实现：当next到达tail的时候，会进行判断，利用率低于70%，进行整理，整理流程大概是&lt;/div&gt;&lt;div&gt;在head和next之间，把next之前的非空元素挪动到前面&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;需要注意什么：由于rpc框架是单进程多协程的，所以防止出现大量整理，导致cpu飙升，会进行渐进式的整理，每次整理一部分，并且记录下&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2.支持持久化：&lt;/div&gt;&lt;div&gt;由于mmap是用的有名映射，所以天然支持持久化&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;不使用mmap：&lt;/div&gt;&lt;div&gt;1.需要设计持久化，这样的话，数据会有两份，一份在内存中，一部分在文件缓存中，并且会进行大量的拷贝&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="77.5" y="1230" width="770" height="240" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-3" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-407" y="1340" width="430" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-4" value="uid1/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-407" y="1340" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-5" value="uid2/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-345" y="1340" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-6" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-283" y="1340" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-7" value="uid4/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-222.99" y="1340" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-8" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-160.99" y="1340" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-9" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-98.99000000000001" y="1340" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-10" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-39" y="1340" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-11" value="head" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-407" y="1310" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-12" value="tail" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-27" y="1310" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-13" value="next" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-157" y="1310" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-15" value="mmap的使用场景：&lt;div&gt;1.私有匿名映射：&lt;/div&gt;&lt;div&gt;主要用于申请内存，一般进程申请大内存的时候，会用到，比如tcmalloc，或者go里面申请内存来自己管理时候&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2.私有有名映射：&lt;/div&gt;&lt;div&gt;主要用于动态库加载，大文件的加载，多进程同时读一份文件的情况，读时共享，写时复制&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3.共享匿名映射：&lt;/div&gt;&lt;div&gt;主要用于父子进程通信&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;4.共享有名映射：&lt;/div&gt;&lt;div&gt;主要用于多进程通信，多进程共享同一份数据&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;5.0拷贝：&lt;/div&gt;&lt;div&gt;mmap可以映射一个文件，直接write，避免的数据从磁盘加载到用户态。&lt;/div&gt;&lt;div&gt;上下文切换：mmap（用户--内核--用户）+write（用户--内核--用户）= 4次&lt;/div&gt;&lt;div&gt;数据流向：磁盘dma--内核内存（用户态共用）--cpu--socket内存--网卡dma&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;6.另外一种零拷贝：&lt;/div&gt;&lt;div&gt;sendfile，直接send一个文件&lt;/div&gt;&lt;div&gt;上下文切换：sendfile（用户--内核--用户）= 2次&lt;/div&gt;&lt;div&gt;数据流向：磁盘dma--内核内存--cpu-- socket内存--网卡dma&lt;/div&gt;&lt;div&gt;内核和socket的内存还能进一步合并成一个，需要支持SG-DMA的网卡&lt;/div&gt;&lt;div&gt;缺点：无法在用户态对数据进行修改，只能发送静态数据&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="77.5" y="1485" width="610" height="350" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-18" value="&lt;div style=&quot;text-align: left;&quot;&gt;现象：进程偶现oom，实际内存还没有用完&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;原因：rpc框架是单进程的，为了利用多核，是采用的proxy+多worker进程&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;并且worker进程为了效率还绑定了cpu的亲和性，然后机器是numa架构的&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;并且运维配置的策略是只在node本地分配内存，不会跨node分配，并且关闭了swap&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;就是说单个node内存用完了，就会oom，即使整个内存还有剩余&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;解决：把亲和性绑定去掉了，并且找运维修改了分配策略，允许去其他node申请内存&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-443" y="1495" width="470" height="130" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-20" value="&lt;div style=&quot;text-align: left;&quot;&gt;为什么要单房间合并：&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;全量拉取：单房间10w用户的话，8字节*10w=0.8Mb&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;千兆网卡的话：1000/0.8/8=150qps，送礼消息不止这么多&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;另外10w用户，几百的qps，会导致千万的qps&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;所以组播需要严格限制请求的频率，上游会做单房间合并的原因&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="815" y="1033" width="360" height="110" as="geometry" />
        </mxCell>
        <mxCell id="V5EH8akgTNUjjNnxu9XO-0" value="&lt;div style=&quot;text-align: left;&quot;&gt;容灾：&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;1.主备：一主一备，写：写主，同步到备，读：失败自动降级到备机，依赖名字服务&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;2.异地：双写，异地切换需要手动&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;扩set：&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;先部署新set，有两个路由，启用双写，一段时间后再启用新路由&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-1160" y="945" width="470" height="100" as="geometry" />
        </mxCell>
        <mxCell id="V5EH8akgTNUjjNnxu9XO-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=0.998;entryY=0.52;entryDx=0;entryDy=0;entryPerimeter=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-6" target="V5EH8akgTNUjjNnxu9XO-0" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-610" y="748" />
              <mxPoint x="-610" y="997" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="V5EH8akgTNUjjNnxu9XO-2" value="连接层维护房间：用户组连接的关系&lt;div&gt;直接支持对房间的广播&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;注意点：同一个房间的用户列表可能出现在不同的机器上&lt;/div&gt;&lt;div&gt;因为用户到后台是有负载均衡的，不会根据房间进行路由&lt;/div&gt;&lt;div&gt;所以需要对所有节点进行广播&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="1241" y="370" width="320" height="100" as="geometry" />
        </mxCell>
        <mxCell id="V5EH8akgTNUjjNnxu9XO-4" value="gonet网络模型：&lt;div&gt;一个连接一个协程，同步处理，代码实现方便&lt;/div&gt;&lt;div&gt;问题：&lt;/div&gt;&lt;div&gt;1.协程数量会随着连接数线性增加，每个协程有至少2kb的栈，百万连接协程就2g内存&lt;/div&gt;&lt;div&gt;2.协程数量上涨带来的调度开销，内存占用和gc压力都很大&lt;/div&gt;&lt;div&gt;3.内核每个连接4kb，协程2kb，至少6g，实际开销更大，gc下一次触发的话，会到15g左右，&lt;/div&gt;&lt;div&gt;gc耗时会严重上涨到秒级别，cpu也会大量耗费在gc上&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;解决：&lt;/div&gt;&lt;div&gt;tnet网络模型优化&lt;/div&gt;&lt;div&gt;1.协程和连接解藕&lt;/div&gt;&lt;div&gt;main reactor + sub Reactor&lt;/div&gt;&lt;div&gt;main reactor负责链接的建立，sub reactor负责读事件的处理，一般是和核心数相同&lt;/div&gt;&lt;div&gt;sub reactor收到请求后，会使用线程池处理事件以及业务逻辑&lt;/div&gt;&lt;div&gt;所以协程数量=sub reactor+活跃的连接&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="1241" y="825" width="510" height="220" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-6" value="dma" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-0" target="prOLGn9-0uz1F6Hl3zky-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-0" value="磁盘" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="77.5" y="2130" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.25;entryY=1;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-1" target="prOLGn9-0uz1F6Hl3zky-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-13" value="cpu拷贝" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="prOLGn9-0uz1F6Hl3zky-10" vertex="1" connectable="0">
          <mxGeometry x="-0.0557" y="-3" relative="1" as="geometry">
            <mxPoint x="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-1" value="内核" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="77.5" y="2020" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-12" value="cpu拷贝" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-2" target="prOLGn9-0uz1F6Hl3zky-3" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="349" y="1985" />
              <mxPoint x="380" y="1985" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-2" value="进程" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="77.5" y="1890" width="362.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-3" value="socket" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="320" y="2020" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-4" target="prOLGn9-0uz1F6Hl3zky-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-9" value="dma" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="prOLGn9-0uz1F6Hl3zky-5" vertex="1" connectable="0">
          <mxGeometry x="-0.15" y="-3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-4" value="网卡" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="320" y="2120" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-16" value="普通拷贝" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="65" y="1860" width="55" height="20" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-17" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="490" y="1860" width="395" height="350" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-18" value="dma" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-19" target="prOLGn9-0uz1F6Hl3zky-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-19" value="磁盘" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="502.5" y="2130" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-33" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-22" target="prOLGn9-0uz1F6Hl3zky-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-34" value="内核cpu拷贝" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="prOLGn9-0uz1F6Hl3zky-33" vertex="1" connectable="0">
          <mxGeometry x="-0.0057" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-22" value="内核" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="502.5" y="2020" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-24" value="进程" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="502.5" y="1890" width="362.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-25" value="socket" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="745" y="2020" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-26" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-28" target="prOLGn9-0uz1F6Hl3zky-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-27" value="dma" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="prOLGn9-0uz1F6Hl3zky-26" vertex="1" connectable="0">
          <mxGeometry x="-0.15" y="-3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-28" value="网卡" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="745" y="2120" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-29" value="mmap+write" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="490" y="1860" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-30" value="" style="shape=flexArrow;endArrow=classic;startArrow=classic;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.166;entryY=0.999;entryDx=0;entryDy=0;entryPerimeter=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-22" target="prOLGn9-0uz1F6Hl3zky-24" edge="1">
          <mxGeometry width="100" height="100" relative="1" as="geometry">
            <mxPoint x="490" y="2050" as="sourcePoint" />
            <mxPoint x="560" y="1950" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-31" value="共享" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="prOLGn9-0uz1F6Hl3zky-30" vertex="1" connectable="0">
          <mxGeometry x="0.072" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-35" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="65" y="2230" width="395" height="350" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-36" value="dma" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-37" target="prOLGn9-0uz1F6Hl3zky-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-37" value="磁盘" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="77.5" y="2500" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-38" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-40" target="prOLGn9-0uz1F6Hl3zky-42" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-39" value="内核cpu拷贝" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="prOLGn9-0uz1F6Hl3zky-38" vertex="1" connectable="0">
          <mxGeometry x="-0.0057" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-40" value="内核" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="77.5" y="2390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-53" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-41" target="prOLGn9-0uz1F6Hl3zky-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-54" value="sendfile" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="prOLGn9-0uz1F6Hl3zky-53" vertex="1" connectable="0">
          <mxGeometry x="-0.0492" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-41" value="进程" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="77.5" y="2260" width="362.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-42" value="socket" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="320" y="2390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-43" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-45" target="prOLGn9-0uz1F6Hl3zky-42" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-44" value="dma" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="prOLGn9-0uz1F6Hl3zky-43" vertex="1" connectable="0">
          <mxGeometry x="-0.15" y="-3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-45" value="网卡" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="320" y="2490" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-46" value="sendfile" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="65" y="2230" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-49" value="" style="endArrow=classic;startArrow=classic;html=1;rounded=0;exitX=0.25;exitY=0;exitDx=0;exitDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="60" y="2000" as="sourcePoint" />
            <mxPoint x="108" y="1950" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-50" value="read&lt;div&gt;上下文切换&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="prOLGn9-0uz1F6Hl3zky-49" vertex="1" connectable="0">
          <mxGeometry x="0.0424" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-51" value="" style="endArrow=classic;startArrow=classic;html=1;rounded=0;exitX=0.75;exitY=0;exitDx=0;exitDy=0;entryX=0.919;entryY=1.019;entryDx=0;entryDy=0;entryPerimeter=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-3" target="prOLGn9-0uz1F6Hl3zky-2" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="370" y="2000" as="sourcePoint" />
            <mxPoint x="420" y="1950" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-52" value="write&lt;div&gt;上下文切换&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="prOLGn9-0uz1F6Hl3zky-51" vertex="1" connectable="0">
          <mxGeometry x="0.0039" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-55" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="490" y="2230" width="395" height="350" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-56" value="dma" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-57" target="prOLGn9-0uz1F6Hl3zky-60" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-57" value="磁盘" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="502.5" y="2500" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-60" value="内核" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="502.5" y="2390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-61" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-63" target="prOLGn9-0uz1F6Hl3zky-60" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-62" value="sendfile" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="prOLGn9-0uz1F6Hl3zky-61" vertex="1" connectable="0">
          <mxGeometry x="-0.0492" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-63" value="进程" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="502.5" y="2260" width="362.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-64" value="socket" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="745" y="2390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-65" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.75;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-67" target="prOLGn9-0uz1F6Hl3zky-60" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-66" value="sg-dma" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="prOLGn9-0uz1F6Hl3zky-65" vertex="1" connectable="0">
          <mxGeometry x="-0.15" y="-3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-67" value="网卡" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="745" y="2490" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-68" value="sg-sendfile" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="490" y="2230" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-69" value="" style="shape=flexArrow;endArrow=classic;startArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" target="prOLGn9-0uz1F6Hl3zky-64" edge="1">
          <mxGeometry width="100" height="100" relative="1" as="geometry">
            <mxPoint x="620" y="2420" as="sourcePoint" />
            <mxPoint x="720" y="2320" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-70" value="共享" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="prOLGn9-0uz1F6Hl3zky-69" vertex="1" connectable="0">
          <mxGeometry x="0.0072" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e5ygJ3nNOSe9Yrahaoav-0" value="每个消息16字节，15wqps，每秒会产生16*15w=240w字节=2.4G&lt;div&gt;消息体是共用的，不会占用很大空间&lt;/div&gt;&lt;div&gt;所以定期删除很重要，如果20s删除一次，那么会占用48G&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#9673a6;fillColor=#e1d5e7;" vertex="1" parent="bxa8RqcD89XLqhrJgpsZ-1">
          <mxGeometry x="1030" y="1233" width="370" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WQOB_-elUw2iNiJAE-nh-5" value="心跳策略：&lt;div style=&quot;&quot;&gt;tcp的keepalive保活是7200s（2h），远远无法使用，没有数据交互运营商NAT几分钟就把连接销毁了&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;根据经验&lt;/div&gt;&lt;div style=&quot;&quot;&gt;中国联通移动，nat保活是5分钟&lt;/div&gt;&lt;div style=&quot;&quot;&gt;中国电信是28分钟&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;客户端会按照这个来发心跳，但是不是完全写死的，会根据失败情况动态调整&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#9673a6;fillColor=#e1d5e7;" vertex="1" parent="bxa8RqcD89XLqhrJgpsZ-1">
          <mxGeometry x="1540" y="160" width="560" height="130" as="geometry" />
        </mxCell>
        <mxCell id="WQOB_-elUw2iNiJAE-nh-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0.215;entryY=0.995;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-8" target="WQOB_-elUw2iNiJAE-nh-5">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1660" y="240" as="targetPoint" />
            <Array as="points">
              <mxPoint x="850" y="350" />
              <mxPoint x="1660" y="350" />
            </Array>
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="F2daYsPlVjmZp15osxFa" name="ai">
    <mxGraphModel dx="1306" dy="867" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="lSxitEgj5gbUgXhKhUQe-1" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="130" y="490" width="760" height="110" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-2" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="130" y="350" width="760" height="110" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-3" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="130" y="200" width="760" height="110" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-4" value="QA" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="152" y="230" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-5" value="摘要" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="294" y="230" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-6" value="速读" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="440" y="230" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-7" value="解读" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="590" y="230" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-8" value="场景" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="130" y="200" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-9" value="搜索增强" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="152" y="380" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-10" value="prompt改写" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="294" y="380" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-11" value="原文召回" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="440" y="380" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-12" value="意图识别" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="590" y="380" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-13" value="推荐问题" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="740" y="230" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-14" value="能力" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="130" y="350" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-15" value="LLM" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="152" y="525" width="270" height="60" as="geometry" />
        </mxCell>
        <mxCell id="RS9Y_8d8AtRgy_yMVYbU-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="lSxitEgj5gbUgXhKhUQe-16" target="RS9Y_8d8AtRgy_yMVYbU-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-16" value="embedding" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="440" y="525" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-17" value="模型" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="130" y="490" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-18" value="向量数据库" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;" parent="1" vertex="1">
          <mxGeometry x="740" y="525" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-19" value="索引计算" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="740" y="380" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="RS9Y_8d8AtRgy_yMVYbU-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="lSxitEgj5gbUgXhKhUQe-20" target="RS9Y_8d8AtRgy_yMVYbU-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="RS9Y_8d8AtRgy_yMVYbU-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;" parent="1" source="lSxitEgj5gbUgXhKhUQe-20" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="810" y="760" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RS9Y_8d8AtRgy_yMVYbU-8" value="性能优化" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="RS9Y_8d8AtRgy_yMVYbU-6" vertex="1" connectable="0">
          <mxGeometry x="0.1424" y="2" relative="1" as="geometry">
            <mxPoint y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-20" value="tokenizer" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="590" y="525" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-21" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="130" y="70" width="760" height="110" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-22" value="http" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="152" y="100" width="328" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-23" value="接入" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="130" y="70" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-24" value="sse" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="500" y="100" width="360" height="60" as="geometry" />
        </mxCell>
        <mxCell id="RS9Y_8d8AtRgy_yMVYbU-2" value="&lt;div&gt;分词器&lt;/div&gt;文本转token" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="605" y="665" width="90" height="40" as="geometry" />
        </mxCell>
        <mxCell id="RS9Y_8d8AtRgy_yMVYbU-4" value="词嵌入&lt;br&gt;把文本转成维度固定的向量" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="415" y="665" width="170" height="40" as="geometry" />
        </mxCell>
        <mxCell id="RS9Y_8d8AtRgy_yMVYbU-7" value="&lt;ol&gt;&lt;li&gt;cpu密集型&lt;/li&gt;&lt;li&gt;python无法利用多核&lt;/li&gt;&lt;li&gt;跨语言调用&lt;/li&gt;&lt;/ol&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="1" vertex="1">
          <mxGeometry x="730" y="763" width="170" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Oy4HNgYHmUS-UnGtXYFu-1" value="历史服务问题：&lt;div&gt;1.日志，监控，告警都没有，经常抛异常&lt;/div&gt;&lt;div&gt;2.定位问题困难，所有人心里都没底，几乎无法上线的状态&lt;/div&gt;&lt;div&gt;3.前面有两个同事接手过，都反应难以维护，有一个同事提过重构，但是老板没同意，估计是觉得风险大&lt;/div&gt;&lt;div&gt;4.当时是排了一个需求给我，我第一次拿到这个代码，也是觉得问题很大，根本没办法改。&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;我做了什么：&lt;/div&gt;&lt;div&gt;1.本来计划是在原来服务进行修改&lt;/div&gt;&lt;div&gt;2.进行了梳理，当时是一个推荐问题的需求，基本上依赖python得部分，就是计算模型生成的问题和已经曝光的问题的相似度，进行去重&lt;/div&gt;&lt;div&gt;大致流程是通过分词器把文本转token，然后通过embedding模型（venus）转向量，再计算向量的余弦相似度。&lt;/div&gt;&lt;div&gt;分析下来这里的模块是依赖python的，所以计划通过trpc-python封装成了接口，给上游调用，逻辑不动&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;然后给老板讲了我的方案，首先这个场景不是核心的，可以用来验证重构的可行性，所以老板也同意了，&lt;/div&gt;&lt;div&gt;我这边就按照这个方案重构了一版并且正常上线了，所以老板看方案可行，就同意了进行重构&lt;/div&gt;&lt;div&gt;所以我这边把核心的qa，摘要，搜索增强几个部分都进行了梳理，把强依赖python得封装成了接口&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;然后老板让另外一个同事，一起对上层的业务逻辑进行了重构，也正常上线了&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;虽然目前正常上线了，风险也降低了很多，从不敢上线到正常上线了，但是还是有问题：&lt;/div&gt;&lt;div&gt;拆出来了几个接口，文本计算token，相似度得分计算，索引计算，召回topn分片，都是依赖本地的模型和python库的&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1.一开始我想的也比较简单，既然单个请求计算慢，那就尝试多线程，但是我实际测试下来发现多线程表现更差，所以网上看了下python的多线程，&lt;/div&gt;&lt;div&gt;才知道python的多线程是有一把全局锁的，拿到锁的才有执行权&lt;/div&gt;&lt;div&gt;，对于cpu密集型的应用来说，多核无法利用，对io密集型还是有用的，这也是python被诟病的一点&lt;/div&gt;&lt;div&gt;多线程下上下文切换反而导致效率更低了&lt;/div&gt;&lt;div&gt;2.trpc-python是通过多进程解决这个问题的，但是在单个请求的长文本下，问题就来了，长文本导致出现长尾请求，而且&lt;/div&gt;&lt;div&gt;如果cpu在计算的时候，还会导致其他小文本的请求被阻塞。长文本的请求无法充分利用机器进行并行运算&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;分析耗时：&lt;/div&gt;&lt;div&gt;所以对耗时进行了分析，用cprofile对函数调用耗时进行采样分析，最后发现了几个耗时点：&lt;/div&gt;&lt;div&gt;1.xml的load，以及xml转markdown&lt;/div&gt;&lt;div&gt;2.本地模型的计算&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;针对这两个分别进行了分析如何优化：&lt;/div&gt;&lt;div&gt;xml的load和转markdown，这个直接在go里面验证了下，长文本，可以从20s降低到1s，这个收益是最明显的，但是也是我目前比较惊讶的点，两个相差了这么多&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2.本地模型计算：&lt;/div&gt;&lt;div&gt;这个需要解决的是模型的运行，调研了下依赖的tokenizer的库其实是rust写的，只是python也支持了&lt;/div&gt;&lt;div&gt;所以一个想法就是rust怎么在go里面运行，想到的解决方案是把rust编译成so，然后用cgo调动态库，我自己本地验证了下&lt;/div&gt;&lt;div&gt;是可行的，而且性能也有提升，这样的话就可以充分利用多核进行计算了&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3.还有一个本地模型，是混元提供的python代码，这个是没办法用上面的进行加载的，所以这个目前初步的方案是想把python编译成动态库&lt;/div&gt;&lt;div&gt;然后进行调用，目前还没验证，理论上是可行的，即使不行，这块单独提成一个接口也是可以接受的。&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;目前这块，还在优化中，因为手上还有其他需求，所以还没做完，预计优化后会有质的提升，本身无法处理的长文能进行处理，&lt;/div&gt;&lt;div&gt;并且还能通过并行计算进行加速，收益应该是非常大的&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;然后这里其实还有更好的解决方案，就是引入向量数据库，这样召回完全依赖向量数据库，就没有这么多麻烦了，而且我公司其他团队也是这样的结局方案&lt;br&gt;&lt;/div&gt;&lt;div&gt;不过这个得仔细评估下召回率之类的，理论上应该是可行的，因为召回率应该是受embedding模型的影响的&lt;/div&gt;&lt;div&gt;并且还有一点，目前是解决了长文本，但是如果用户再传一个特别大的，即使并行计算也可能需要很长时间，如果引入向量数据库&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;可以把现在的同步流程改异步&lt;/div&gt;&lt;div&gt;目前是上传，拆分分片，拆好了用户才能问答，是一个同步的流程&lt;/div&gt;&lt;div&gt;有向量数据库的话，可以边分片边往向量数据库添加，用户那边不阻塞，就是可能会影响一开始的准确率，不过相比于无法使用来说，还是算很大的提升&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;向量数据库这个我只是自己验证过，还没有仔细评估&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="1" vertex="1">
          <mxGeometry x="990" y="285" width="870" height="810" as="geometry" />
        </mxCell>
        <mxCell id="Oy4HNgYHmUS-UnGtXYFu-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Oy4HNgYHmUS-UnGtXYFu-2" target="Oy4HNgYHmUS-UnGtXYFu-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Oy4HNgYHmUS-UnGtXYFu-2" value="应用逻辑层服务" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="380" y="940" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Oy4HNgYHmUS-UnGtXYFu-7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Oy4HNgYHmUS-UnGtXYFu-3" target="Oy4HNgYHmUS-UnGtXYFu-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Oy4HNgYHmUS-UnGtXYFu-9" value="直调" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Oy4HNgYHmUS-UnGtXYFu-3" target="Oy4HNgYHmUS-UnGtXYFu-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Oy4HNgYHmUS-UnGtXYFu-3" value="trpc-python" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="380" y="1080" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Oy4HNgYHmUS-UnGtXYFu-8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Oy4HNgYHmUS-UnGtXYFu-4" target="Oy4HNgYHmUS-UnGtXYFu-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="280" y="1310" />
              <mxPoint x="440" y="1310" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Oy4HNgYHmUS-UnGtXYFu-4" value="协议转换" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="220" y="1200" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Oy4HNgYHmUS-UnGtXYFu-5" value="venus" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="380" y="1340" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-11" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="Llirzcwe5Y8x6eCoUDJh-2" target="Llirzcwe5Y8x6eCoUDJh-5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-2" value="xml转markdown" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2120" y="370" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="Llirzcwe5Y8x6eCoUDJh-3" target="Llirzcwe5Y8x6eCoUDJh-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-3" value="xml序列化" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2120" y="260" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="Llirzcwe5Y8x6eCoUDJh-4" target="Llirzcwe5Y8x6eCoUDJh-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-4" value="分片" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2120" y="170" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-12" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="Llirzcwe5Y8x6eCoUDJh-5" target="Llirzcwe5Y8x6eCoUDJh-6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-5" value="计算片段的token" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2120" y="465" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-13" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="Llirzcwe5Y8x6eCoUDJh-6" target="Llirzcwe5Y8x6eCoUDJh-7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-6" value="再把token反向计算成文本" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2120" y="560" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-15" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="Llirzcwe5Y8x6eCoUDJh-7" target="Llirzcwe5Y8x6eCoUDJh-8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-7" value="根据长度限制&lt;div&gt;把长文本拆成多断&lt;/div&gt;&lt;div&gt;把短文本合并&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2120" y="655" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-8" value="提取表格表头&lt;div&gt;表格被拆分成多段后&lt;/div&gt;&lt;div&gt;补充表头&lt;/div&gt;&lt;div&gt;并且补充表头前面的段落&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2105" y="770" width="150" height="77" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-21" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="Llirzcwe5Y8x6eCoUDJh-17" target="Llirzcwe5Y8x6eCoUDJh-18">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-17" value="相似度计算" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2380" y="170" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-22" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="Llirzcwe5Y8x6eCoUDJh-18" target="Llirzcwe5Y8x6eCoUDJh-19">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-18" value="文本转token" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2380" y="260" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-23" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="Llirzcwe5Y8x6eCoUDJh-19" target="Llirzcwe5Y8x6eCoUDJh-20">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-19" value="token进行embedding&lt;div&gt;返回向量&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2380" y="360" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-20" value="向量计算&lt;div&gt;余弦距离等&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2380" y="460" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-24" value="本地模型&lt;div&gt;rust编译加速&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" vertex="1" parent="1">
          <mxGeometry x="2520" y="270" width="90" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-25" value="并行" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="2050" y="485" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-26" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;labelPosition=left;verticalLabelPosition=middle;align=right;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="2058" y="290" width="20" height="120" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-27" value="go重写" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="1980" y="328" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-28" value="并行" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="2050" y="570" width="50" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="gg-zCY3S3wDtr2VuZ_-A" name="activity">
    <mxGraphModel dx="2363" dy="2189" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="xs7M36CM43rjV9m2G4Hp-72" value="" style="rounded=0;whiteSpace=wrap;html=1;dashed=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="650" y="435" width="360" height="325" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-69" value="" style="rounded=0;whiteSpace=wrap;html=1;dashed=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="-10" y="30" width="580" height="620" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-64" value="" style="rounded=0;whiteSpace=wrap;html=1;dashed=1;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="-520" y="280" width="360" height="620" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-1" value="pk服务" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="138" y="320" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-2" value="mysql" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" vertex="1" parent="1">
          <mxGeometry x="138" y="470" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="xs7M36CM43rjV9m2G4Hp-4" target="xs7M36CM43rjV9m2G4Hp-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-4" value="段位赛pk逻辑服务" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="8" y="80" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-67" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="xs7M36CM43rjV9m2G4Hp-5" target="xs7M36CM43rjV9m2G4Hp-30">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="xs7M36CM43rjV9m2G4Hp-5" target="xs7M36CM43rjV9m2G4Hp-74">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-2" value="创建/结算竞猜" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="ebTP9VvHCpq9uHz0mKpL-1">
          <mxGeometry x="0.2421" y="1" relative="1" as="geometry">
            <mxPoint y="12" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-5" value="" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;rotation=90;" vertex="1" parent="1">
          <mxGeometry x="263" y="465" width="60" height="90" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-6" value="kafka" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="258" y="495" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="xs7M36CM43rjV9m2G4Hp-1" target="xs7M36CM43rjV9m2G4Hp-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-37" value="事务" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="xs7M36CM43rjV9m2G4Hp-7">
          <mxGeometry x="-0.2889" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="xs7M36CM43rjV9m2G4Hp-1" target="xs7M36CM43rjV9m2G4Hp-5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-21" value="创建/加分/结算事件" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="xs7M36CM43rjV9m2G4Hp-8">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="xs7M36CM43rjV9m2G4Hp-10" target="xs7M36CM43rjV9m2G4Hp-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-10" value="吃鸡pk逻辑" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="138" y="80" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="xs7M36CM43rjV9m2G4Hp-11" target="xs7M36CM43rjV9m2G4Hp-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-18" value="匹配/特殊场景外部开启pk" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="xs7M36CM43rjV9m2G4Hp-14">
          <mxGeometry x="0.6387" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-11" value="年度盛典等" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="268" y="80" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-25" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="xs7M36CM43rjV9m2G4Hp-22" target="xs7M36CM43rjV9m2G4Hp-24">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-22" value="通用榜单写" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="680" y="480" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-24" value="redis" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" vertex="1" parent="1">
          <mxGeometry x="790" y="650" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-27" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="xs7M36CM43rjV9m2G4Hp-26" target="xs7M36CM43rjV9m2G4Hp-24">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-29" value="各种时间维度的榜单&lt;div&gt;小时/日/周/月榜&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="xs7M36CM43rjV9m2G4Hp-27">
          <mxGeometry x="0.69" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-26" value="通用榜单读" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="850" y="480" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-32" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="xs7M36CM43rjV9m2G4Hp-30" target="xs7M36CM43rjV9m2G4Hp-22">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-30" value="pk各种场景的榜单统计" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="400" y="480" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-35" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="xs7M36CM43rjV9m2G4Hp-33" target="xs7M36CM43rjV9m2G4Hp-24">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-36" value="对账" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="xs7M36CM43rjV9m2G4Hp-35">
          <mxGeometry x="-0.12" y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-33" value="mysql" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" vertex="1" parent="1">
          <mxGeometry x="680" y="650" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-34" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="xs7M36CM43rjV9m2G4Hp-22" target="xs7M36CM43rjV9m2G4Hp-33">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-39" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;" edge="1" parent="1" source="xs7M36CM43rjV9m2G4Hp-1" target="xs7M36CM43rjV9m2G4Hp-1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="298" y="335" />
              <mxPoint x="298" y="365" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-40" value="&lt;span style=&quot;caret-color: rgba(0, 0, 0, 0); color: rgba(0, 0, 0, 0); font-family: monospace; font-size: 0px; text-align: start; background-color: rgb(251, 251, 251);&quot;&gt;%3CmxGraphModel%3E%3Croot%3E%3CmxCell%20id%3D%220%22%2F%3E%3CmxCell%20id%3D%221%22%20parent%3D%220%22%2F%3E%3CmxCell%20id%3D%222%22%20value%3D%22%E5%88%9B%E5%BB%BA%2F%E7%BB%93%E7%AE%97%22%20style%3D%22edgeLabel%3Bhtml%3D1%3Balign%3Dcenter%3BverticalAlign%3Dmiddle%3Bresizable%3D0%3Bpoints%3D%5B%5D%3B%22%20vertex%3D%221%22%20connectable%3D%220%22%20parent%3D%221%22%3E%3CmxGeometry%20x%3D%2249%22%20y%3D%22350%22%20as%3D%22geometry%22%2F%3E%3C%2FmxCell%3E%3C%2Froot%3E%3C%2FmxGraphModel%&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="xs7M36CM43rjV9m2G4Hp-39">
          <mxGeometry y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-41" value="创建/结算" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="1">
          <mxGeometry x="298" y="350" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-68" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" parent="1" source="xs7M36CM43rjV9m2G4Hp-42" target="xs7M36CM43rjV9m2G4Hp-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-42" value="" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;rotation=90;" vertex="1" parent="1">
          <mxGeometry x="-110" y="300" width="60" height="100" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-43" value="kafka" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="-120" y="335" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-61" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="xs7M36CM43rjV9m2G4Hp-45" target="xs7M36CM43rjV9m2G4Hp-49">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-45" value="送礼服务" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-380" y="320" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-47" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="xs7M36CM43rjV9m2G4Hp-45" target="xs7M36CM43rjV9m2G4Hp-42">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-59" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="xs7M36CM43rjV9m2G4Hp-49" target="xs7M36CM43rjV9m2G4Hp-52">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-60" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="xs7M36CM43rjV9m2G4Hp-49" target="xs7M36CM43rjV9m2G4Hp-54">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-49" value="支付网关" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-380" y="510" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-50" value="包裹&lt;div&gt;mysql&lt;/div&gt;" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" vertex="1" parent="1">
          <mxGeometry x="-440" y="770" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-53" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="xs7M36CM43rjV9m2G4Hp-52" target="xs7M36CM43rjV9m2G4Hp-50">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-52" value="自运营包裹服务" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-470" y="630" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-58" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="xs7M36CM43rjV9m2G4Hp-54" target="xs7M36CM43rjV9m2G4Hp-57">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-54" value="公司的米大师" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-310" y="630" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-57" value="tdsql" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" vertex="1" parent="1">
          <mxGeometry x="-280" y="770" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-65" value="送礼相关" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="-520" y="280" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-70" value="pk相关" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="-10" y="30" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-73" value="榜单" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="650" y="435" width="70" height="25" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-75" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="xs7M36CM43rjV9m2G4Hp-74" target="xs7M36CM43rjV9m2G4Hp-49">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-80" y="750" />
              <mxPoint x="-80" y="540" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="d5rrUPnheSEeBodwmt4X-1" value="资金池设计&lt;div&gt;保证不超发&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="xs7M36CM43rjV9m2G4Hp-75">
          <mxGeometry x="-0.2668" y="-3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-79" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.75;entryDx=0;entryDy=0;" edge="1" parent="1" source="xs7M36CM43rjV9m2G4Hp-74" target="xs7M36CM43rjV9m2G4Hp-22">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="620" y="630" as="targetPoint" />
            <Array as="points">
              <mxPoint x="600" y="750" />
              <mxPoint x="600" y="525" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-74" value="竞猜服务" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="232" y="730" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-76" value="mysql" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" vertex="1" parent="1">
          <mxGeometry x="337" y="900" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-77" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="xs7M36CM43rjV9m2G4Hp-74" target="xs7M36CM43rjV9m2G4Hp-76">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-83" value="对账" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="xs7M36CM43rjV9m2G4Hp-80" target="xs7M36CM43rjV9m2G4Hp-76">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-80" value="redis" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" vertex="1" parent="1">
          <mxGeometry x="189" y="900" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-82" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="xs7M36CM43rjV9m2G4Hp-74" target="xs7M36CM43rjV9m2G4Hp-80">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="ebTP9VvHCpq9uHz0mKpL-3" target="xs7M36CM43rjV9m2G4Hp-45">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-5" value="送礼" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="ebTP9VvHCpq9uHz0mKpL-4">
          <mxGeometry x="-0.0657" y="3" relative="1" as="geometry">
            <mxPoint y="-1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-3" value="" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shadow=0;dashed=0;strokeWidth=1;shape=mxgraph.android.phone2;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="-345.64" y="50" width="51.28" height="100" as="geometry" />
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.75;entryDx=0;entryDy=0;" edge="1" parent="1" source="ebTP9VvHCpq9uHz0mKpL-7" target="xs7M36CM43rjV9m2G4Hp-74">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-9" value="下注" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="ebTP9VvHCpq9uHz0mKpL-8">
          <mxGeometry x="0.0057" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-7" value="" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shadow=0;dashed=0;strokeWidth=1;shape=mxgraph.android.phone2;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="598.72" y="850" width="51.28" height="100" as="geometry" />
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="ebTP9VvHCpq9uHz0mKpL-10" target="xs7M36CM43rjV9m2G4Hp-26">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-12" value="拉榜单" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="ebTP9VvHCpq9uHz0mKpL-11">
          <mxGeometry x="0.0048" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-10" value="" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shadow=0;dashed=0;strokeWidth=1;shape=mxgraph.android.phone2;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="884.36" y="210" width="51.28" height="100" as="geometry" />
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="ebTP9VvHCpq9uHz0mKpL-13" target="xs7M36CM43rjV9m2G4Hp-4">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="198" y="-10" />
              <mxPoint x="68" y="-10" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="ebTP9VvHCpq9uHz0mKpL-13" target="xs7M36CM43rjV9m2G4Hp-10">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="ebTP9VvHCpq9uHz0mKpL-13" target="xs7M36CM43rjV9m2G4Hp-11">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="198" y="-10" />
              <mxPoint x="328" y="-10" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-18" value="发起pk" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="ebTP9VvHCpq9uHz0mKpL-17">
          <mxGeometry x="-0.7828" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-13" value="" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shadow=0;dashed=0;strokeWidth=1;shape=mxgraph.android.phone2;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="172.36" y="-170" width="51.28" height="100" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="NUvMHLy74Mf8xs66AC7l" name="第 5 页">
    <mxGraphModel dx="2133" dy="867" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="IDojizpqGfUpgZ52IpqX-24" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-120" y="50" width="1150" height="390" as="geometry" />
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;" edge="1" parent="1" source="IDojizpqGfUpgZ52IpqX-1" target="IDojizpqGfUpgZ52IpqX-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-5" value="leader心跳超时" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="IDojizpqGfUpgZ52IpqX-4">
          <mxGeometry x="-0.0333" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-1" value="follower&lt;div&gt;跟随者&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="90" y="220" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;" edge="1" parent="1" source="IDojizpqGfUpgZ52IpqX-2" target="IDojizpqGfUpgZ52IpqX-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-8" value="收到半数以上投票" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="IDojizpqGfUpgZ52IpqX-7">
          <mxGeometry x="0.0667" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.25;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="IDojizpqGfUpgZ52IpqX-2" target="IDojizpqGfUpgZ52IpqX-1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="340" y="320" />
              <mxPoint x="120" y="320" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-14" value="发现更新的选举者" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="IDojizpqGfUpgZ52IpqX-13">
          <mxGeometry relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-2" value="candidate&lt;div&gt;选举者&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="310" y="220" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.75;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="IDojizpqGfUpgZ52IpqX-3" target="IDojizpqGfUpgZ52IpqX-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-12" value="有更新的选举者，term更大" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="IDojizpqGfUpgZ52IpqX-11">
          <mxGeometry x="0.008" y="-4" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=0;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;dashed=1;" edge="1" parent="1" source="IDojizpqGfUpgZ52IpqX-3" target="IDojizpqGfUpgZ52IpqX-1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="640" y="110" />
              <mxPoint x="180" y="110" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-18" value="定期发送心跳，保证leader的地位" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="IDojizpqGfUpgZ52IpqX-17">
          <mxGeometry y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-22" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="IDojizpqGfUpgZ52IpqX-3" target="IDojizpqGfUpgZ52IpqX-1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="700" y="390" />
              <mxPoint x="90" y="390" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-23" value="日志复制给所有跟随者，半数以上确认则回复客户端" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="IDojizpqGfUpgZ52IpqX-22">
          <mxGeometry x="-0.0024" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-3" value="leader&lt;div&gt;主&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="610" y="220" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=0;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="IDojizpqGfUpgZ52IpqX-2" target="IDojizpqGfUpgZ52IpqX-2">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="340" y="170" />
              <mxPoint x="400" y="170" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-10" value="选举超时" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="IDojizpqGfUpgZ52IpqX-9">
          <mxGeometry x="-0.025" y="4" relative="1" as="geometry">
            <mxPoint x="2" y="4" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-15" value="" style="shape=flexArrow;endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-10" y="250" as="sourcePoint" />
            <mxPoint x="70" y="250" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-16" value="开始" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="5" y="198" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="IDojizpqGfUpgZ52IpqX-19" target="IDojizpqGfUpgZ52IpqX-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-21" value="提交日志" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="IDojizpqGfUpgZ52IpqX-20">
          <mxGeometry x="0.0154" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-19" value="client" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="860" y="220" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-25" value="raft" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="-120" y="50" width="90" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
