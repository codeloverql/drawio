<mxfile host="app.diagrams.net" modified="2024-06-10T15:02:27.638Z" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2.1 Safari/605.1.15" etag="WJwi9nXin1QU_MtFijht" version="24.5.2" type="github" pages="6">
  <diagram name="live" id="U2sys6m2P0nSdcJm8TKS">
    <mxGraphModel dx="2960" dy="867" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-2" target="x6Jtk6zeUvlKm-oWEQXY-118" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-2" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-592" y="870" width="610" height="392" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-5" target="x6Jtk6zeUvlKm-oWEQXY-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="120" y="880" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-5" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-502" y="560" width="430" height="250" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-7" target="x6Jtk6zeUvlKm-oWEQXY-111" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-7" value="连接管理服务" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="730" y="390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-10" target="x6Jtk6zeUvlKm-oWEQXY-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-9" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;单播/广播&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-8" vertex="1" connectable="0">
          <mxGeometry x="0.0166" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-10" value="推送逻辑服务" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="414" y="390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-15" target="x6Jtk6zeUvlKm-oWEQXY-35" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-12" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;组播-房间成员列表&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-11" vertex="1" connectable="0">
          <mxGeometry x="0.1596" y="2" relative="1" as="geometry">
            <mxPoint x="-1" y="-2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-13" value="解决千万级别消息扩散" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-15" target="x6Jtk6zeUvlKm-oWEQXY-112" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-15" target="x6Jtk6zeUvlKm-oWEQXY-129" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-15" value="消息投递服务" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="20" y="390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-18" target="x6Jtk6zeUvlKm-oWEQXY-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-17" value="单个uid路由到一台机器上&lt;br&gt;缓存命中高" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-16" vertex="1" connectable="0">
          <mxGeometry x="0.2806" y="-1" relative="1" as="geometry">
            <mxPoint y="52" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-18" value="" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;rotation=90;" parent="1" vertex="1">
          <mxGeometry x="250" y="515" width="60" height="150" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-15" target="x6Jtk6zeUvlKm-oWEQXY-18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-20" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;可靠消息/非可靠消息&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-19" vertex="1" connectable="0">
          <mxGeometry x="0.0146" y="3" relative="1" as="geometry">
            <mxPoint y="14" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-21" value="根据uid分key投递" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-19" vertex="1" connectable="0">
          <mxGeometry x="-0.4862" y="-2" relative="1" as="geometry">
            <mxPoint y="23" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-22" value="消息队列" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="240" y="575" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-23" value="" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-457" y="610" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-24" value="成员set" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-447" y="620" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-25" value="" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-357" y="720" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-26" value="成员set" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-347" y="730" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-27" value="" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-247" y="605" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-28" value="成员set" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-237" y="615" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-29" value="成员列表服务" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="-502" y="560" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-30" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-35" target="x6Jtk6zeUvlKm-oWEQXY-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-31" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;房间路由&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-30" vertex="1" connectable="0">
          <mxGeometry x="-0.0249" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-35" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-30" y="680" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-33" value="可能成为性能瓶颈" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-32" vertex="1" connectable="0">
          <mxGeometry x="0.1599" y="-2" relative="1" as="geometry">
            <mxPoint x="5" y="151" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-34" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;dashed=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-35" target="x6Jtk6zeUvlKm-oWEQXY-96" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9cAvgB88gob5KMhP02BU-6" value="旁路只写，故障切换" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-34" vertex="1" connectable="0">
          <mxGeometry x="-0.0892" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-35" value="房间成员逻辑服务" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-347" y="390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-36" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;建连/心跳&lt;/span&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-39" target="x6Jtk6zeUvlKm-oWEQXY-7" edge="1">
          <mxGeometry x="0.0105" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-37" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.75;entryY=0;entryDx=0;entryDy=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-39" target="x6Jtk6zeUvlKm-oWEQXY-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-38" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;可靠消息上报确认&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-37" vertex="1" connectable="0">
          <mxGeometry x="-0.148" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-39" value="" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shadow=0;dashed=0;strokeWidth=1;shape=mxgraph.android.phone2;strokeColor=#c0c0c0;" parent="1" vertex="1">
          <mxGeometry x="769.48" y="210" width="41.03" height="80" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-40" value="redis" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" parent="1" vertex="1">
          <mxGeometry x="610" y="550" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-41" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0;entryDx=0;entryDy=27.5;entryPerimeter=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-7" target="x6Jtk6zeUvlKm-oWEQXY-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-42" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;维护uid和节点信息&lt;br&gt;（zset多设备）&lt;br&gt;ip:port-&amp;gt;ts&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-41" vertex="1" connectable="0">
          <mxGeometry x="0.3957" relative="1" as="geometry">
            <mxPoint x="44" y="-3" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-43" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-45" target="x6Jtk6zeUvlKm-oWEQXY-35" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-44" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;进退房：3w/s&lt;br&gt;心跳约10s一次：3w/s&lt;br&gt;&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-43" vertex="1" connectable="0">
          <mxGeometry x="-0.2642" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-45" value="" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shadow=0;dashed=0;strokeWidth=1;shape=mxgraph.android.phone2;strokeColor=#c0c0c0;" parent="1" vertex="1">
          <mxGeometry x="-307.51" y="210" width="41.03" height="80" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-46" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-48" target="x6Jtk6zeUvlKm-oWEQXY-15" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-47" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;单播/广播-普通路由&lt;br&gt;组播-roomid哈希路由&lt;br&gt;严格控制调用来源&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-46" vertex="1" connectable="0">
          <mxGeometry x="-0.0211" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-48" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-47.5" y="200" width="255" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-49" value="送礼" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-32.5" y="210" width="50" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-50" value="发言" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="27.5" y="210" width="50" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-51" value="pk" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="90" y="210" width="50" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-52" value="信令" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="147.5" y="210" width="50" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-53" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-10" target="x6Jtk6zeUvlKm-oWEQXY-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-54" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;cache miss或者失败&lt;br&gt;查询连接节点&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-53" vertex="1" connectable="0">
          <mxGeometry x="0.1519" relative="1" as="geometry">
            <mxPoint y="24" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-55" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-57" target="x6Jtk6zeUvlKm-oWEQXY-119" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-56" value="可靠消息列表&lt;br&gt;消息防重列表&lt;br&gt;zset" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-55" vertex="1" connectable="0">
          <mxGeometry x="-0.0843" relative="1" as="geometry">
            <mxPoint y="-1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-57" value="redis" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" parent="1" vertex="1">
          <mxGeometry x="444" y="550" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-58" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-10" target="x6Jtk6zeUvlKm-oWEQXY-57" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-59" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;可靠消息确认&lt;br&gt;非可靠消息防重&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-58" vertex="1" connectable="0">
          <mxGeometry x="-0.2642" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-60" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-554" y="892" width="430" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-61" value="uid1/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-554" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-62" value="uid2/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-492" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-63" value="uid3/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-430" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-64" value="uid4/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-369.99" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-65" value="....." style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-307.99" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-66" value="uid/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-245.99" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-67" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-69" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-42" y="912.0000000000002" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-68" value="异步落盘" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-67" vertex="1" connectable="0">
          <mxGeometry x="-0.0822" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-69" value="uid/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-186" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-70" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-320" y="1000" width="62" height="230" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-71" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-72" target="x6Jtk6zeUvlKm-oWEQXY-80" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-72" value="uid1" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-320" y="1000" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-73" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-74" target="x6Jtk6zeUvlKm-oWEQXY-81" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-74" value="uid2" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-320" y="1050" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-75" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-76" target="x6Jtk6zeUvlKm-oWEQXY-82" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-76" value="uid3" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-320" y="1110" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-77" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-78" target="x6Jtk6zeUvlKm-oWEQXY-83" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-78" value="uid4" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-320" y="1170" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-79" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.509;entryY=0.997;entryDx=0;entryDy=0;entryPerimeter=0;dashed=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-80" target="x6Jtk6zeUvlKm-oWEQXY-84" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-80" value="0" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-196" y="1015" width="31" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-81" value="1" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-196" y="1065" width="31" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-82" value="2" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-196" y="1125" width="31" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-83" value="3" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-196" y="1185" width="31" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-84" value="0" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="-537" y="930" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-85" value="1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="-467" y="930" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-86" value="2" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="-407" y="930" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-87" value="3" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="-347" y="930" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-88" value="10w" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="-187" y="930" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-89" value="存储设计" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="-72" y="1222" width="90" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-90" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-502" y="1000" width="62" height="230" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-91" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-92" target="x6Jtk6zeUvlKm-oWEQXY-72" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-92" value="roomid1" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-502" y="1000" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-93" value="roomid2" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-502" y="1050" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-94" value="..." style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-502" y="1110" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-95" value="roomidN" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-502" y="1170" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-96" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;" parent="1" vertex="1">
          <mxGeometry x="-1050" y="560" width="430" height="250" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-97" value="" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-1005" y="610" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-98" value="成员set" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-995" y="620" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-99" value="" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-905" y="720" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-100" value="成员set" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-895" y="730" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-101" value="" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-795" y="605" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-102" value="成员set" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-785" y="615" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-103" value="成员列表服务&lt;br&gt;异地容灾" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="-1050" y="560" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-104" value="PCU：30w&lt;br&gt;DAU：420w&lt;br&gt;单房间最大：10w&lt;br&gt;日活主播：4w" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#82b366;fillColor=#d5e8d4;" parent="1" vertex="1">
          <mxGeometry x="-347" y="100" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-105" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-107" target="x6Jtk6zeUvlKm-oWEQXY-35" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-106" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;其他读：5w/s&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="x6Jtk6zeUvlKm-oWEQXY-105" vertex="1" connectable="0">
          <mxGeometry x="-0.1057" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-107" value="其他服务" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-582" y="390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-108" value="单房间最多10w用户&lt;br&gt;&lt;span style=&quot;text-wrap: nowrap;&quot;&gt;单机&lt;/span&gt;&lt;div style=&quot;text-wrap: nowrap;&quot;&gt;2w/s写&lt;br&gt;1.5w/s读&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="-192" y="750" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-109" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-110" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1170" y="715" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-110" value="&lt;ol&gt;&lt;li&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;gonet-&amp;gt;tnet网络模型优化&lt;/span&gt;&lt;br&gt;&lt;/li&gt;&lt;li&gt;内存下降45%&lt;/li&gt;&lt;li&gt;cpu下降20%&lt;/li&gt;&lt;li&gt;单机连接数提升100%&lt;/li&gt;&lt;/ol&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="1" vertex="1">
          <mxGeometry x="860" y="670" width="200" height="90" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-111" value="优化：连接层支持组播方案&lt;br&gt;解决超大直播间网卡瓶颈" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="1" vertex="1">
          <mxGeometry x="980" y="400" width="170" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-112" value="1.单房间消息合并&lt;br&gt;2.消息分级，消息丢弃&lt;br&gt;3.超大房间限流，降级丢弃" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="1" vertex="1">
          <mxGeometry x="-12" y="545" width="170" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-113" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;全量拉取，100w房间，目前最大10w&lt;/span&gt;&lt;/div&gt;&lt;div&gt;数据量8mb，千兆网卡最大qps=1000/8/8=15qps&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="1" vertex="1">
          <mxGeometry x="-60" y="690" width="280" height="40" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-114" value="" style="sketch=0;pointerEvents=1;shadow=0;dashed=0;html=1;strokeColor=none;fillColor=#505050;labelPosition=center;verticalLabelPosition=bottom;verticalAlign=top;outlineConnect=0;align=center;shape=mxgraph.office.devices.hard_disk;" parent="1" vertex="1">
          <mxGeometry x="-40" y="885" width="40" height="54" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-115" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0.504;entryY=0.015;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-7" target="x6Jtk6zeUvlKm-oWEQXY-110" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-116" value="oom排查和优化" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="1" vertex="1">
          <mxGeometry x="65" y="885" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-117" value="&lt;ol&gt;&lt;li&gt;原有模型压测：单机50w，7G内存&lt;/li&gt;&lt;li&gt;升级后压测：单机50w，4G&lt;/li&gt;&lt;li&gt;压测百万连接&lt;/li&gt;&lt;/ol&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="1" vertex="1">
          <mxGeometry x="1100" y="675" width="250" height="80" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-118" value="&lt;ol&gt;&lt;li&gt;碎片整理&lt;/li&gt;&lt;li&gt;支持持久化，快速重启&lt;/li&gt;&lt;/ol&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="1" vertex="1">
          <mxGeometry x="65" y="1031" width="180" height="70" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-119" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="446" y="740" width="54" height="250" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-120" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-121" target="x6Jtk6zeUvlKm-oWEQXY-123" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-121" value="msgid" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="446" y="740" width="54" height="50" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-122" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-123" target="x6Jtk6zeUvlKm-oWEQXY-128" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-123" value="status&amp;lt;&amp;lt;32+ts&lt;br&gt;status=0 未确认&lt;div&gt;statue=1 确认&lt;/div&gt;&lt;div&gt;status=2 丢弃/非可靠消息&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="540" y="725" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-124" value="msgid" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="446" y="790" width="54" height="50" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-125" value="msgid" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="446" y="840" width="54" height="50" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-126" value="msgid" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="446" y="890" width="54" height="50" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-127" value="msgid" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="446" y="940" width="54" height="50" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-128" value="快速筛选：&lt;div&gt;小于1&amp;lt;&amp;lt;32 就是未确认的消息，还能进一步根据时间筛选，进行重发&lt;/div&gt;&lt;div&gt;大于1&amp;gt;&amp;gt;32 的定期删除，防止列表过大&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="1" vertex="1">
          <mxGeometry x="534" y="855" width="380" height="60" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-129" value="雪花算法id生成" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="1" vertex="1">
          <mxGeometry x="175" y="370" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-130" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="205" y="350" width="185" height="20" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-131" value="时间戳ms" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="205" y="350" width="65" height="20" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-132" value="机器" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="270" y="350" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-133" value="incr" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="350" y="350" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-134" value="41" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="217.5" y="320" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-135" value="8" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="282.5" y="320" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-136" value="12" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="355" y="320" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-137" value="时间线" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="310" y="350" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-138" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="x6Jtk6zeUvlKm-oWEQXY-139" target="x6Jtk6zeUvlKm-oWEQXY-142" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-139" value="2" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="320" y="320" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-140" value="0" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="175" y="350" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-141" value="1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="175" y="320" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x6Jtk6zeUvlKm-oWEQXY-142" value="解决时钟回拨" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="1" vertex="1">
          <mxGeometry x="285" y="268" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="lPl_-dJKi4ZWcJyu0Dkh-1" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="970" y="200" width="500" height="30" as="geometry" />
        </mxCell>
        <mxCell id="lPl_-dJKi4ZWcJyu0Dkh-2" value="magic" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="970" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="lPl_-dJKi4ZWcJyu0Dkh-3" value="len" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1020" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="lPl_-dJKi4ZWcJyu0Dkh-4" value="头len" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1070" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="lPl_-dJKi4ZWcJyu0Dkh-5" value="编码" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1120" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="lPl_-dJKi4ZWcJyu0Dkh-7" value="压缩" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1170" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="lPl_-dJKi4ZWcJyu0Dkh-8" value="加密" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1220" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="lPl_-dJKi4ZWcJyu0Dkh-9" value="..." style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1270" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="lPl_-dJKi4ZWcJyu0Dkh-10" value="数据" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1370" y="200" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="lPl_-dJKi4ZWcJyu0Dkh-11" value="协议重要字段" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="865" y="200" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="lPl_-dJKi4ZWcJyu0Dkh-12" value="头扩展" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1320" y="200" width="50" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="live 的副本" id="hugfhMHL9A4iMEHUzqtO">
    <mxGraphModel dx="2960" dy="867" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-0" />
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-1" parent="bxa8RqcD89XLqhrJgpsZ-0" />
        <mxCell id="prOLGn9-0uz1F6Hl3zky-15" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="65" y="1860" width="395" height="350" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-3" target="bxa8RqcD89XLqhrJgpsZ-121" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-3" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-592" y="870" width="610" height="392" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-6" target="bxa8RqcD89XLqhrJgpsZ-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="120" y="880" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-6" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-502" y="560" width="430" height="250" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-8" target="bxa8RqcD89XLqhrJgpsZ-114" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-8" value="连接管理服务" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="730" y="390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-11" target="bxa8RqcD89XLqhrJgpsZ-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-10" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;单播/广播&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-9" vertex="1" connectable="0">
          <mxGeometry x="0.0166" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-11" value="推送逻辑服务" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="414" y="390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-17" target="bxa8RqcD89XLqhrJgpsZ-38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-13" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;组播-房间成员列表&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-12" vertex="1" connectable="0">
          <mxGeometry x="0.1596" y="2" relative="1" as="geometry">
            <mxPoint x="-1" y="-2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-14" value="解决千万级别消息扩散" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-17" target="bxa8RqcD89XLqhrJgpsZ-115" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-17" target="bxa8RqcD89XLqhrJgpsZ-132" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.25;exitDx=0;exitDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-17" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-90" y="106" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-17" value="消息投递服务" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="20" y="390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-20" target="bxa8RqcD89XLqhrJgpsZ-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-19" value="单个uid路由到一台机器上&lt;br&gt;缓存命中高" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-18" vertex="1" connectable="0">
          <mxGeometry x="0.2806" y="-1" relative="1" as="geometry">
            <mxPoint y="52" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-20" value="" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;rotation=90;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="250" y="515" width="60" height="150" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-21" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-17" target="bxa8RqcD89XLqhrJgpsZ-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-22" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;可靠消息/非可靠消息&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-21" vertex="1" connectable="0">
          <mxGeometry x="0.0146" y="3" relative="1" as="geometry">
            <mxPoint y="14" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-23" value="根据uid分key投递" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-21" vertex="1" connectable="0">
          <mxGeometry x="-0.4862" y="-2" relative="1" as="geometry">
            <mxPoint y="23" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-24" value="消息队列" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="240" y="575" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-25" value="" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-457" y="610" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-26" value="成员set" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-447" y="620" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-27" value="" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-357" y="720" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-28" value="成员set" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-347" y="730" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-29" value="" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-247" y="605" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-30" value="成员set" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-237" y="615" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-31" value="成员列表服务" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-502" y="560" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-38" target="bxa8RqcD89XLqhrJgpsZ-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-33" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;房间路由&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-32" vertex="1" connectable="0">
          <mxGeometry x="-0.0249" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-34" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-38" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-30" y="680" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-35" value="可能成为性能瓶颈" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-34" vertex="1" connectable="0">
          <mxGeometry x="0.1599" y="-2" relative="1" as="geometry">
            <mxPoint x="5" y="151" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-36" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;dashed=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-38" target="bxa8RqcD89XLqhrJgpsZ-99" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-37" value="旁路只写，故障切换" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-36" vertex="1" connectable="0">
          <mxGeometry x="-0.0892" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-38" value="房间成员逻辑服务" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-347" y="390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-39" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;建连/心跳&lt;/span&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-42" target="bxa8RqcD89XLqhrJgpsZ-8" edge="1">
          <mxGeometry x="0.0105" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-40" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.75;entryY=0;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-42" target="bxa8RqcD89XLqhrJgpsZ-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-41" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;可靠消息上报确认&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-40" vertex="1" connectable="0">
          <mxGeometry x="-0.148" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-42" value="" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shadow=0;dashed=0;strokeWidth=1;shape=mxgraph.android.phone2;strokeColor=#c0c0c0;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="769.48" y="210" width="41.03" height="80" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-43" value="redis" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="610" y="550" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-44" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0;entryDx=0;entryDy=27.5;entryPerimeter=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-8" target="bxa8RqcD89XLqhrJgpsZ-43" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-45" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;维护uid和节点信息&lt;br&gt;（zset多设备）&lt;br&gt;ip:port-&amp;gt;ts&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-44" vertex="1" connectable="0">
          <mxGeometry x="0.3957" relative="1" as="geometry">
            <mxPoint x="44" y="-3" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-46" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-48" target="bxa8RqcD89XLqhrJgpsZ-38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-47" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;进退房：3w/s&lt;br&gt;心跳约10s一次：3w/s&lt;br&gt;&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-46" vertex="1" connectable="0">
          <mxGeometry x="-0.2642" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-48" value="" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shadow=0;dashed=0;strokeWidth=1;shape=mxgraph.android.phone2;strokeColor=#c0c0c0;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-307.51" y="210" width="41.03" height="80" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-49" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-51" target="bxa8RqcD89XLqhrJgpsZ-17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-50" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;单播/广播-普通路由&lt;br&gt;组播-roomid哈希路由&lt;br&gt;严格控制调用来源&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-49" vertex="1" connectable="0">
          <mxGeometry x="-0.0211" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-51" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-47.5" y="200" width="255" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-52" value="送礼" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-32.5" y="210" width="50" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-53" value="发言" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="27.5" y="210" width="50" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-54" value="pk" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="90" y="210" width="50" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-55" value="信令" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="147.5" y="210" width="50" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-56" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-11" target="bxa8RqcD89XLqhrJgpsZ-43" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-57" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;cache miss或者失败&lt;br&gt;查询连接节点&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-56" vertex="1" connectable="0">
          <mxGeometry x="0.1519" relative="1" as="geometry">
            <mxPoint y="24" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-58" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-60" target="bxa8RqcD89XLqhrJgpsZ-122" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-59" value="可靠消息列表&lt;br&gt;消息防重列表&lt;br&gt;zset" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-58" vertex="1" connectable="0">
          <mxGeometry x="-0.0843" relative="1" as="geometry">
            <mxPoint y="-1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-60" value="redis" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="444" y="550" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-61" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-11" target="bxa8RqcD89XLqhrJgpsZ-60" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-62" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;可靠消息确认&lt;br&gt;非可靠消息防重&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-61" vertex="1" connectable="0">
          <mxGeometry x="-0.2642" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-63" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-554" y="892" width="430" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-64" value="uid1/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-554" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-65" value="uid2/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-492" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-66" value="uid3/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-430" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-67" value="uid4/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-369.99" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-68" value="....." style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-307.99" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-69" value="uid/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-245.99" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-70" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-72" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-42" y="912.0000000000002" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-71" value="异步落盘" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-70" vertex="1" connectable="0">
          <mxGeometry x="-0.0822" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-72" value="uid/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-186" y="892" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-73" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-320" y="1000" width="62" height="230" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-74" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-75" target="bxa8RqcD89XLqhrJgpsZ-83" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-75" value="uid1" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-320" y="1000" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-76" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-77" target="bxa8RqcD89XLqhrJgpsZ-84" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-77" value="uid2" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-320" y="1050" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-78" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-79" target="bxa8RqcD89XLqhrJgpsZ-85" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-79" value="uid3" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-320" y="1110" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-80" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-81" target="bxa8RqcD89XLqhrJgpsZ-86" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-81" value="uid4" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-320" y="1170" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-82" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.509;entryY=0.997;entryDx=0;entryDy=0;entryPerimeter=0;dashed=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-83" target="bxa8RqcD89XLqhrJgpsZ-87" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-83" value="0" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-196" y="1015" width="31" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-84" value="1" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-196" y="1065" width="31" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-85" value="2" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-196" y="1125" width="31" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-86" value="3" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-196" y="1185" width="31" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-87" value="0" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-537" y="930" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-88" value="1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-467" y="930" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-89" value="2" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-407" y="930" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-90" value="3" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-347" y="930" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-91" value="10w" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-187" y="930" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-92" value="存储设计" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-72" y="1222" width="90" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-93" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-502" y="1000" width="62" height="230" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-94" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-95" target="bxa8RqcD89XLqhrJgpsZ-75" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-95" value="roomid1" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-502" y="1000" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-96" value="roomid2" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-502" y="1050" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-97" value="..." style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-502" y="1110" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-98" value="roomidN" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-502" y="1170" width="62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-99" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-1050" y="560" width="430" height="250" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-100" value="" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-1005" y="610" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-101" value="成员set" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-995" y="620" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-102" value="" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-905" y="720" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-103" value="成员set" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-895" y="730" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-104" value="" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-795" y="605" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-105" value="成员set" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-785" y="615" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-106" value="成员列表服务&lt;br&gt;异地容灾" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-1050" y="560" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-107" value="PCU：30w&lt;br&gt;DAU：420w&lt;br&gt;单房间最大：10w&lt;br&gt;日活主播：4w" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#82b366;fillColor=#d5e8d4;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-347" y="100" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-108" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-110" target="bxa8RqcD89XLqhrJgpsZ-38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-109" value="&lt;span style=&quot;font-size: 12px; background-color: rgb(251, 251, 251);&quot;&gt;其他读：5w/s&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="bxa8RqcD89XLqhrJgpsZ-108" vertex="1" connectable="0">
          <mxGeometry x="-0.1057" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-110" value="其他服务" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-582" y="390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-111" value="单房间最多10w用户&lt;br&gt;&lt;span style=&quot;text-wrap: nowrap;&quot;&gt;单机&lt;/span&gt;&lt;div style=&quot;text-wrap: nowrap;&quot;&gt;2w/s写&lt;br&gt;1.5w/s读&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-192" y="750" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-112" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-113" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1170" y="715" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-113" value="&lt;ol&gt;&lt;li&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;gonet-&amp;gt;tnet网络模型优化&lt;/span&gt;&lt;br&gt;&lt;/li&gt;&lt;li&gt;内存下降45%&lt;/li&gt;&lt;li&gt;cpu下降20%&lt;/li&gt;&lt;li&gt;单机连接数提升100%&lt;/li&gt;&lt;/ol&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="860" y="670" width="200" height="90" as="geometry" />
        </mxCell>
        <mxCell id="V5EH8akgTNUjjNnxu9XO-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-114" target="V5EH8akgTNUjjNnxu9XO-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-114" value="优化：连接层支持组播方案&lt;br&gt;解决超大直播间网卡瓶颈" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="980" y="400" width="170" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-0" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-115" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="350" y="1090" as="targetPoint" />
            <Array as="points">
              <mxPoint x="73" y="650" />
              <mxPoint x="351" y="650" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-115" value="1.单房间消息合并&lt;br&gt;2.消息分级，消息丢弃&lt;br&gt;3.超大房间限流，降级丢弃" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-12" y="545" width="170" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-21" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-116" target="ZDgZF7WNOIpqBr-gDZdw-20" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="260" y="710" />
              <mxPoint x="260" y="1000" />
              <mxPoint x="990" y="1000" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-116" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;全量拉取，100w房间，目前最大10w&lt;/span&gt;&lt;/div&gt;&lt;div&gt;100w数据量8mb，千兆网卡最大qps=1000/8/8=15qps&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-60" y="690" width="310" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-117" value="" style="sketch=0;pointerEvents=1;shadow=0;dashed=0;html=1;strokeColor=none;fillColor=#505050;labelPosition=center;verticalLabelPosition=bottom;verticalAlign=top;outlineConnect=0;align=center;shape=mxgraph.office.devices.hard_disk;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-40" y="885" width="40" height="54" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-118" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0.504;entryY=0.015;entryDx=0;entryDy=0;entryPerimeter=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-8" target="bxa8RqcD89XLqhrJgpsZ-113" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.546;entryY=0.05;entryDx=0;entryDy=0;entryPerimeter=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-119" target="ZDgZF7WNOIpqBr-gDZdw-18" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-170" y="1460" as="targetPoint" />
            <Array as="points">
              <mxPoint x="50" y="900" />
              <mxPoint x="50" y="1502" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-119" value="oom排查和优化" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="65" y="885" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="V5EH8akgTNUjjNnxu9XO-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-120" target="V5EH8akgTNUjjNnxu9XO-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-120" value="&lt;ol&gt;&lt;li&gt;原有模型压测：单机50w，7G内存&lt;/li&gt;&lt;li&gt;升级后压测：单机50w，4G&lt;/li&gt;&lt;li&gt;压测百万连接&lt;/li&gt;&lt;/ol&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="1100" y="675" width="250" height="80" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-121" target="ZDgZF7WNOIpqBr-gDZdw-2" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="155" y="1210" />
              <mxPoint x="460" y="1210" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-121" value="&lt;ol&gt;&lt;li&gt;碎片整理&lt;/li&gt;&lt;li&gt;支持持久化，快速重启&lt;/li&gt;&lt;/ol&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="65" y="1031" width="180" height="70" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-122" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="446" y="740" width="54" height="250" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-123" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-124" target="bxa8RqcD89XLqhrJgpsZ-126" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-124" value="msgid" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="446" y="740" width="54" height="50" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-125" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-126" target="bxa8RqcD89XLqhrJgpsZ-131" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-126" value="status&amp;lt;&amp;lt;32+ts&lt;br&gt;status=0 未确认&lt;div&gt;statue=1 确认&lt;/div&gt;&lt;div&gt;status=2 丢弃/非可靠消息&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="540" y="725" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-127" value="msgid" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="446" y="790" width="54" height="50" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-128" value="msgid" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="446" y="840" width="54" height="50" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-129" value="msgid" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="446" y="890" width="54" height="50" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-130" value="msgid" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="446" y="940" width="54" height="50" as="geometry" />
        </mxCell>
        <mxCell id="e5ygJ3nNOSe9Yrahaoav-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-131" target="e5ygJ3nNOSe9Yrahaoav-0" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-131" value="快速筛选：&lt;div&gt;小于1&amp;lt;&amp;lt;32 就是未确认的消息，还能进一步根据时间筛选，进行重发&lt;/div&gt;&lt;div&gt;大于1&amp;gt;&amp;gt;32 的定期删除，防止列表过大&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="534" y="855" width="380" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-132" value="雪花算法id生成" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="175" y="370" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-133" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="205" y="350" width="185" height="20" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-134" value="时间戳ms" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="205" y="350" width="65" height="20" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-135" value="机器" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="270" y="350" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-136" value="incr" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="350" y="350" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-137" value="41" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="217.5" y="320" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-138" value="8" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="282.5" y="320" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-139" value="12" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="355" y="320" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-140" value="时间线" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="310" y="350" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-141" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-142" target="bxa8RqcD89XLqhrJgpsZ-145" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-142" value="2" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="320" y="320" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-143" value="0" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="175" y="350" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-144" value="1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="175" y="320" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-145" value="解决时钟回拨" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="285" y="268" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-146" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="970" y="200" width="500" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-147" value="magic" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="970" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-148" value="len" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="1020" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-149" value="头len" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="1070" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-150" value="编码" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="1120" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-151" value="压缩" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="1170" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-152" value="加密" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="1220" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-153" value="..." style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="1270" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-154" value="数据" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="1370" y="200" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-155" value="协议重要字段" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="865" y="200" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-156" value="头扩展" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="1320" y="200" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bxa8RqcD89XLqhrJgpsZ-157" value="&lt;div style=&quot;text-align: left;&quot;&gt;千兆网卡单房间：&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;最大：送礼消息128字节+发言256字节+其他128字节=512字节&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;512*10w*0.7压缩=350w字节=3.5MB&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-165" y="30" width="350" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-22" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="ZDgZF7WNOIpqBr-gDZdw-1" target="ZDgZF7WNOIpqBr-gDZdw-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-1" value="1.单房间合并：&lt;div&gt;组播消息上游调过来是通过roomid做的一致性hash路由&lt;/div&gt;&lt;div&gt;在服务内部会对单个房间的消息进行合并，2s内的消息合并，2s的定时任务进行推送&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2.消息分级：&lt;/div&gt;&lt;div&gt;针对送礼，进退房，发言，信令等消息，进行分级：信令&amp;gt;送礼&amp;gt;发言&amp;gt;进退房广播&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3.超过10w的房间，才会开启限流，进行丢弃，目前基本不会触发这个阈值&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;4.可靠消息，根据类型进行配置，上游不能控制，严格控制主调来源，防止广播风暴&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="295" y="1038" width="470" height="150" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="ZDgZF7WNOIpqBr-gDZdw-2" target="ZDgZF7WNOIpqBr-gDZdw-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-2" value="1.碎片整理：&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;出现原因：退房或者超时被清理，会导致数组出现空洞&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;有什么影响：不进行整理的话，会导致next指针一直往后移，内存占用上涨，而实际可能并没有很多人在房间内&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;如何实现：当next到达tail的时候，会进行判断，利用率低于70%，进行整理，整理流程大概是&lt;/div&gt;&lt;div&gt;在head和next之间，把next之前的非空元素挪动到前面&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;需要注意什么：由于rpc框架是单进程多协程的，所以防止出现大量整理，导致cpu飙升，会进行渐进式的整理，每次整理一部分，并且记录下&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2.支持持久化：&lt;/div&gt;&lt;div&gt;由于mmap是用的有名映射，所以天然支持持久化&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;不使用mmap：&lt;/div&gt;&lt;div&gt;1.需要设计持久化，这样的话，数据会有两份，一份在内存中，一部分在文件缓存中，并且会进行大量的拷贝&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="77.5" y="1230" width="770" height="240" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-3" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-407" y="1340" width="430" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-4" value="uid1/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-407" y="1340" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-5" value="uid2/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-345" y="1340" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-6" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-283" y="1340" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-7" value="uid4/score" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-222.99" y="1340" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-8" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-160.99" y="1340" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-9" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-98.99000000000001" y="1340" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-10" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-39" y="1340" width="62" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-11" value="head" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-407" y="1310" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-12" value="tail" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-27" y="1310" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-13" value="next" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-157" y="1310" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-15" value="mmap的使用场景：&lt;div&gt;1.私有匿名映射：&lt;/div&gt;&lt;div&gt;主要用于申请内存，一般进程申请大内存的时候，会用到，比如tcmalloc，或者go里面申请内存来自己管理时候&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2.私有有名映射：&lt;/div&gt;&lt;div&gt;主要用于动态库加载，大文件的加载，多进程同时读一份文件的情况，读时共享，写时复制&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3.共享匿名映射：&lt;/div&gt;&lt;div&gt;主要用于父子进程通信&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;4.共享有名映射：&lt;/div&gt;&lt;div&gt;主要用于多进程通信，多进程共享同一份数据&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;5.0拷贝：&lt;/div&gt;&lt;div&gt;mmap可以映射一个文件，直接write，避免的数据从磁盘加载到用户态。&lt;/div&gt;&lt;div&gt;上下文切换：mmap（用户--内核--用户）+write（用户--内核--用户）= 4次&lt;/div&gt;&lt;div&gt;数据流向：磁盘dma--内核内存（用户态共用）--cpu--socket内存--网卡dma&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;6.另外一种零拷贝：&lt;/div&gt;&lt;div&gt;sendfile，直接send一个文件&lt;/div&gt;&lt;div&gt;上下文切换：sendfile（用户--内核--用户）= 2次&lt;/div&gt;&lt;div&gt;数据流向：磁盘dma--内核内存--cpu-- socket内存--网卡dma&lt;/div&gt;&lt;div&gt;内核和socket的内存还能进一步合并成一个，需要支持SG-DMA的网卡&lt;/div&gt;&lt;div&gt;缺点：无法在用户态对数据进行修改，只能发送静态数据&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="77.5" y="1485" width="610" height="350" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-18" value="&lt;div style=&quot;text-align: left;&quot;&gt;现象：进程偶现oom，实际内存还没有用完&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;原因：rpc框架是单进程的，为了利用多核，是采用的proxy+多worker进程&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;并且worker进程为了效率还绑定了cpu的亲和性，然后机器是numa架构的&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;并且运维配置的策略是只在node本地分配内存，不会跨node分配，并且关闭了swap&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;就是说单个node内存用完了，就会oom，即使整个内存还有剩余&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;解决：把亲和性绑定去掉了，并且找运维修改了分配策略，允许去其他node申请内存&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-443" y="1495" width="470" height="130" as="geometry" />
        </mxCell>
        <mxCell id="ZDgZF7WNOIpqBr-gDZdw-20" value="&lt;div style=&quot;text-align: left;&quot;&gt;为什么要单房间合并：&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;全量拉取：单房间10w用户的话，8字节*10w=0.8Mb&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;千兆网卡的话：1000/0.8/8=150qps，送礼消息不止这么多&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;另外10w用户，几百的qps，会导致千万的qps&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;所以组播需要严格限制请求的频率，上游会做单房间合并的原因&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="815" y="1033" width="360" height="110" as="geometry" />
        </mxCell>
        <mxCell id="V5EH8akgTNUjjNnxu9XO-0" value="&lt;div style=&quot;text-align: left;&quot;&gt;容灾：&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;1.主备：一主一备，写：写主，同步到备，读：失败自动降级到备机，依赖名字服务&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;2.异地：双写，异地切换需要手动&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;扩set：&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;先部署新set，有两个路由，启用双写，一段时间后再启用新路由&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-1160" y="945" width="470" height="100" as="geometry" />
        </mxCell>
        <mxCell id="V5EH8akgTNUjjNnxu9XO-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=0.998;entryY=0.52;entryDx=0;entryDy=0;entryPerimeter=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-6" target="V5EH8akgTNUjjNnxu9XO-0" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-610" y="748" />
              <mxPoint x="-610" y="997" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="V5EH8akgTNUjjNnxu9XO-2" value="连接层维护房间：用户组连接的关系&lt;div&gt;直接支持对房间的广播&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;注意点：同一个房间的用户列表可能出现在不同的机器上&lt;/div&gt;&lt;div&gt;因为用户到后台是有负载均衡的，不会根据房间进行路由&lt;/div&gt;&lt;div&gt;所以需要对所有节点进行广播&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="1241" y="370" width="320" height="100" as="geometry" />
        </mxCell>
        <mxCell id="V5EH8akgTNUjjNnxu9XO-4" value="gonet网络模型：&lt;div&gt;一个连接一个协程，同步处理，代码实现方便&lt;/div&gt;&lt;div&gt;问题：&lt;/div&gt;&lt;div&gt;1.协程数量会随着连接数线性增加，每个协程有至少2kb的栈，百万连接协程就2g内存&lt;/div&gt;&lt;div&gt;2.协程数量上涨带来的调度开销，内存占用和gc压力都很大&lt;/div&gt;&lt;div&gt;3.内核每个连接4kb，协程2kb，至少6g，实际开销更大，gc下一次触发的话，会到15g左右，&lt;/div&gt;&lt;div&gt;gc耗时会严重上涨到秒级别，cpu也会大量耗费在gc上&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;解决：&lt;/div&gt;&lt;div&gt;tnet网络模型优化&lt;/div&gt;&lt;div&gt;1.协程和连接解藕&lt;/div&gt;&lt;div&gt;main reactor + sub Reactor&lt;/div&gt;&lt;div&gt;main reactor负责链接的建立，sub reactor负责读事件的处理，一般是和核心数相同&lt;/div&gt;&lt;div&gt;sub reactor收到请求后，会使用线程池处理事件以及业务逻辑&lt;/div&gt;&lt;div&gt;所以协程数量=sub reactor+活跃的连接&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="1241" y="825" width="510" height="220" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-6" value="dma" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-0" target="prOLGn9-0uz1F6Hl3zky-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-0" value="磁盘" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="77.5" y="2130" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.25;entryY=1;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-1" target="prOLGn9-0uz1F6Hl3zky-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-13" value="cpu拷贝" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="prOLGn9-0uz1F6Hl3zky-10" vertex="1" connectable="0">
          <mxGeometry x="-0.0557" y="-3" relative="1" as="geometry">
            <mxPoint x="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-1" value="内核" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="77.5" y="2020" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-12" value="cpu拷贝" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-2" target="prOLGn9-0uz1F6Hl3zky-3" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="349" y="1985" />
              <mxPoint x="380" y="1985" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-2" value="进程" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="77.5" y="1890" width="362.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-3" value="socket" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="320" y="2020" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-4" target="prOLGn9-0uz1F6Hl3zky-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-9" value="dma" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="prOLGn9-0uz1F6Hl3zky-5" vertex="1" connectable="0">
          <mxGeometry x="-0.15" y="-3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-4" value="网卡" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="320" y="2120" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-16" value="普通拷贝" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="65" y="1860" width="55" height="20" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-17" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="490" y="1860" width="395" height="350" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-18" value="dma" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-19" target="prOLGn9-0uz1F6Hl3zky-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-19" value="磁盘" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="502.5" y="2130" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-33" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-22" target="prOLGn9-0uz1F6Hl3zky-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-34" value="内核cpu拷贝" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="prOLGn9-0uz1F6Hl3zky-33" vertex="1" connectable="0">
          <mxGeometry x="-0.0057" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-22" value="内核" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="502.5" y="2020" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-24" value="进程" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="502.5" y="1890" width="362.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-25" value="socket" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="745" y="2020" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-26" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-28" target="prOLGn9-0uz1F6Hl3zky-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-27" value="dma" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="prOLGn9-0uz1F6Hl3zky-26" vertex="1" connectable="0">
          <mxGeometry x="-0.15" y="-3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-28" value="网卡" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="745" y="2120" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-29" value="mmap+write" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="490" y="1860" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-30" value="" style="shape=flexArrow;endArrow=classic;startArrow=classic;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.166;entryY=0.999;entryDx=0;entryDy=0;entryPerimeter=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-22" target="prOLGn9-0uz1F6Hl3zky-24" edge="1">
          <mxGeometry width="100" height="100" relative="1" as="geometry">
            <mxPoint x="490" y="2050" as="sourcePoint" />
            <mxPoint x="560" y="1950" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-31" value="共享" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="prOLGn9-0uz1F6Hl3zky-30" vertex="1" connectable="0">
          <mxGeometry x="0.072" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-35" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="65" y="2230" width="395" height="350" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-36" value="dma" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-37" target="prOLGn9-0uz1F6Hl3zky-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-37" value="磁盘" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="77.5" y="2500" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-38" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-40" target="prOLGn9-0uz1F6Hl3zky-42" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-39" value="内核cpu拷贝" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="prOLGn9-0uz1F6Hl3zky-38" vertex="1" connectable="0">
          <mxGeometry x="-0.0057" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-40" value="内核" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="77.5" y="2390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-53" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-41" target="prOLGn9-0uz1F6Hl3zky-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-54" value="sendfile" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="prOLGn9-0uz1F6Hl3zky-53" vertex="1" connectable="0">
          <mxGeometry x="-0.0492" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-41" value="进程" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="77.5" y="2260" width="362.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-42" value="socket" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="320" y="2390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-43" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-45" target="prOLGn9-0uz1F6Hl3zky-42" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-44" value="dma" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="prOLGn9-0uz1F6Hl3zky-43" vertex="1" connectable="0">
          <mxGeometry x="-0.15" y="-3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-45" value="网卡" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="320" y="2490" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-46" value="sendfile" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="65" y="2230" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-49" value="" style="endArrow=classic;startArrow=classic;html=1;rounded=0;exitX=0.25;exitY=0;exitDx=0;exitDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="60" y="2000" as="sourcePoint" />
            <mxPoint x="108" y="1950" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-50" value="read&lt;div&gt;上下文切换&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="prOLGn9-0uz1F6Hl3zky-49" vertex="1" connectable="0">
          <mxGeometry x="0.0424" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-51" value="" style="endArrow=classic;startArrow=classic;html=1;rounded=0;exitX=0.75;exitY=0;exitDx=0;exitDy=0;entryX=0.919;entryY=1.019;entryDx=0;entryDy=0;entryPerimeter=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-3" target="prOLGn9-0uz1F6Hl3zky-2" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="370" y="2000" as="sourcePoint" />
            <mxPoint x="420" y="1950" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-52" value="write&lt;div&gt;上下文切换&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="prOLGn9-0uz1F6Hl3zky-51" vertex="1" connectable="0">
          <mxGeometry x="0.0039" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-55" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="490" y="2230" width="395" height="350" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-56" value="dma" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-57" target="prOLGn9-0uz1F6Hl3zky-60" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-57" value="磁盘" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="502.5" y="2500" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-60" value="内核" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="502.5" y="2390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-61" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-63" target="prOLGn9-0uz1F6Hl3zky-60" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-62" value="sendfile" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="prOLGn9-0uz1F6Hl3zky-61" vertex="1" connectable="0">
          <mxGeometry x="-0.0492" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-63" value="进程" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="502.5" y="2260" width="362.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-64" value="socket" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="745" y="2390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-65" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.75;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="prOLGn9-0uz1F6Hl3zky-67" target="prOLGn9-0uz1F6Hl3zky-60" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-66" value="sg-dma" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="prOLGn9-0uz1F6Hl3zky-65" vertex="1" connectable="0">
          <mxGeometry x="-0.15" y="-3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-67" value="网卡" style="rounded=1;whiteSpace=wrap;html=1;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="745" y="2490" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-68" value="sg-sendfile" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="490" y="2230" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-69" value="" style="shape=flexArrow;endArrow=classic;startArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" target="prOLGn9-0uz1F6Hl3zky-64" edge="1">
          <mxGeometry width="100" height="100" relative="1" as="geometry">
            <mxPoint x="620" y="2420" as="sourcePoint" />
            <mxPoint x="720" y="2320" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="prOLGn9-0uz1F6Hl3zky-70" value="共享" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="prOLGn9-0uz1F6Hl3zky-69" vertex="1" connectable="0">
          <mxGeometry x="0.0072" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e5ygJ3nNOSe9Yrahaoav-0" value="每个消息16字节，15wqps，每秒会产生16*15w=240w字节=2.4G&lt;div&gt;消息体是共用的，不会占用很大空间&lt;/div&gt;&lt;div&gt;所以定期删除很重要，如果20s删除一次，那么会占用48G&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="1030" y="1233" width="370" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WQOB_-elUw2iNiJAE-nh-5" value="心跳策略：&lt;div style=&quot;&quot;&gt;tcp的keepalive保活是7200s（2h），远远无法使用，没有数据交互运营商NAT几分钟就把连接销毁了&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;根据经验&lt;/div&gt;&lt;div style=&quot;&quot;&gt;中国联通移动，nat保活是5分钟&lt;/div&gt;&lt;div style=&quot;&quot;&gt;中国电信是28分钟&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;客户端会按照这个来发心跳，但是不是完全写死的，会根据失败情况动态调整&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="1540" y="160" width="560" height="130" as="geometry" />
        </mxCell>
        <mxCell id="WQOB_-elUw2iNiJAE-nh-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0.215;entryY=0.995;entryDx=0;entryDy=0;entryPerimeter=0;" parent="bxa8RqcD89XLqhrJgpsZ-1" source="bxa8RqcD89XLqhrJgpsZ-8" target="WQOB_-elUw2iNiJAE-nh-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1660" y="240" as="targetPoint" />
            <Array as="points">
              <mxPoint x="850" y="350" />
              <mxPoint x="1660" y="350" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="bFB7nporcsFnesR4Epy5-0" value="mlock可以锁定mmap的page cache，防止被换出到磁盘，导致延时的增加" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="bxa8RqcD89XLqhrJgpsZ-1" vertex="1">
          <mxGeometry x="-447" y="1670" width="410" height="30" as="geometry" />
        </mxCell>
        <mxCell id="W3BF5M609fenWsnfe3d6-0" value="epoll" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="bxa8RqcD89XLqhrJgpsZ-1">
          <mxGeometry x="2068" y="780" width="120" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="F2daYsPlVjmZp15osxFa" name="ai">
    <mxGraphModel dx="1306" dy="2036" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="lSxitEgj5gbUgXhKhUQe-1" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="130" y="490" width="760" height="110" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-2" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="130" y="350" width="760" height="110" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-3" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="130" y="200" width="760" height="110" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-4" value="QA" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="152" y="230" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-5" value="摘要" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="294" y="230" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-6" value="速读" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="440" y="230" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-7" value="解读" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="590" y="230" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-8" value="场景" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="130" y="200" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-9" value="搜索增强" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="152" y="380" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-10" value="prompt改写" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="294" y="380" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-11" value="原文召回" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="440" y="380" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-12" value="意图识别" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="590" y="380" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-13" value="推荐问题" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="740" y="230" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-14" value="能力" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="130" y="350" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-15" value="LLM" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="152" y="525" width="270" height="60" as="geometry" />
        </mxCell>
        <mxCell id="RS9Y_8d8AtRgy_yMVYbU-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="lSxitEgj5gbUgXhKhUQe-16" target="RS9Y_8d8AtRgy_yMVYbU-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-16" value="embedding" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="440" y="525" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-17" value="模型" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="130" y="490" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-18" value="向量数据库" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;" parent="1" vertex="1">
          <mxGeometry x="740" y="525" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-19" value="索引计算" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="740" y="380" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="RS9Y_8d8AtRgy_yMVYbU-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="lSxitEgj5gbUgXhKhUQe-20" target="RS9Y_8d8AtRgy_yMVYbU-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="RS9Y_8d8AtRgy_yMVYbU-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;" parent="1" source="lSxitEgj5gbUgXhKhUQe-20" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="810" y="760" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="RS9Y_8d8AtRgy_yMVYbU-8" value="性能优化" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="RS9Y_8d8AtRgy_yMVYbU-6" vertex="1" connectable="0">
          <mxGeometry x="0.1424" y="2" relative="1" as="geometry">
            <mxPoint y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-20" value="tokenizer" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="590" y="525" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-21" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="130" y="70" width="760" height="110" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-22" value="http" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="152" y="100" width="328" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-23" value="接入" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="130" y="70" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="lSxitEgj5gbUgXhKhUQe-24" value="sse" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="500" y="100" width="360" height="60" as="geometry" />
        </mxCell>
        <mxCell id="RS9Y_8d8AtRgy_yMVYbU-2" value="&lt;div&gt;分词器&lt;/div&gt;文本转token" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="605" y="665" width="90" height="40" as="geometry" />
        </mxCell>
        <mxCell id="RS9Y_8d8AtRgy_yMVYbU-4" value="词嵌入&lt;br&gt;把文本转成维度固定的向量" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="415" y="665" width="170" height="40" as="geometry" />
        </mxCell>
        <mxCell id="RS9Y_8d8AtRgy_yMVYbU-7" value="&lt;ol&gt;&lt;li&gt;cpu密集型&lt;/li&gt;&lt;li&gt;python无法利用多核&lt;/li&gt;&lt;li&gt;跨语言调用&lt;/li&gt;&lt;/ol&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="1" vertex="1">
          <mxGeometry x="730" y="763" width="170" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Oy4HNgYHmUS-UnGtXYFu-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Oy4HNgYHmUS-UnGtXYFu-2" target="Oy4HNgYHmUS-UnGtXYFu-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Oy4HNgYHmUS-UnGtXYFu-2" value="应用逻辑层服务" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="380" y="940" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Oy4HNgYHmUS-UnGtXYFu-7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Oy4HNgYHmUS-UnGtXYFu-3" target="Oy4HNgYHmUS-UnGtXYFu-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Oy4HNgYHmUS-UnGtXYFu-9" value="直调" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Oy4HNgYHmUS-UnGtXYFu-3" target="Oy4HNgYHmUS-UnGtXYFu-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Oy4HNgYHmUS-UnGtXYFu-3" value="trpc-python" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="380" y="1080" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Oy4HNgYHmUS-UnGtXYFu-8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Oy4HNgYHmUS-UnGtXYFu-4" target="Oy4HNgYHmUS-UnGtXYFu-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="280" y="1310" />
              <mxPoint x="440" y="1310" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Oy4HNgYHmUS-UnGtXYFu-4" value="协议转换" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="220" y="1200" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Oy4HNgYHmUS-UnGtXYFu-5" value="venus" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="380" y="1340" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-11" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Llirzcwe5Y8x6eCoUDJh-2" target="Llirzcwe5Y8x6eCoUDJh-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-2" value="xml转markdown" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2410" y="350" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Llirzcwe5Y8x6eCoUDJh-3" target="Llirzcwe5Y8x6eCoUDJh-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-3" value="xml序列化" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2410" y="240" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Llirzcwe5Y8x6eCoUDJh-4" target="Llirzcwe5Y8x6eCoUDJh-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-4" value="分片" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2410" y="150" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-12" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Llirzcwe5Y8x6eCoUDJh-5" target="Llirzcwe5Y8x6eCoUDJh-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-5" value="计算片段的token" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2410" y="445" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-13" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Llirzcwe5Y8x6eCoUDJh-6" target="Llirzcwe5Y8x6eCoUDJh-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-6" value="再把token反向计算成文本" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2410" y="540" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-15" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Llirzcwe5Y8x6eCoUDJh-7" target="Llirzcwe5Y8x6eCoUDJh-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-7" value="根据长度限制&lt;div&gt;把长文本拆成多断&lt;/div&gt;&lt;div&gt;把短文本合并&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2410" y="635" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-8" value="提取表格表头&lt;div&gt;表格被拆分成多段后&lt;/div&gt;&lt;div&gt;补充表头&lt;/div&gt;&lt;div&gt;并且补充表头前面的段落&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2395" y="750" width="150" height="77" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-21" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Llirzcwe5Y8x6eCoUDJh-17" target="Llirzcwe5Y8x6eCoUDJh-18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-17" value="相似度计算" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2670" y="150" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-22" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Llirzcwe5Y8x6eCoUDJh-18" target="Llirzcwe5Y8x6eCoUDJh-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-18" value="文本转token" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2670" y="240" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-23" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Llirzcwe5Y8x6eCoUDJh-19" target="Llirzcwe5Y8x6eCoUDJh-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-19" value="token进行embedding&lt;div&gt;返回向量&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2670" y="340" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-20" value="向量计算&lt;div&gt;余弦距离等&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2670" y="440" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="HGC4ebqBViCwbnQyxVzQ-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Llirzcwe5Y8x6eCoUDJh-24" target="HGC4ebqBViCwbnQyxVzQ-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-24" value="本地模型&lt;div&gt;rust编译加速&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="1" vertex="1">
          <mxGeometry x="2810" y="250" width="90" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-25" value="并行" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2340" y="465" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-26" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;labelPosition=left;verticalLabelPosition=middle;align=right;verticalAlign=middle;" parent="1" vertex="1">
          <mxGeometry x="2348" y="270" width="20" height="120" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-27" value="go重写" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2270" y="308" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Llirzcwe5Y8x6eCoUDJh-28" value="并行" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2340" y="550" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="HGC4ebqBViCwbnQyxVzQ-1" value="分词器" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2590" y="258" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="HGC4ebqBViCwbnQyxVzQ-2" value="词嵌入" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2590" y="358" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="HGC4ebqBViCwbnQyxVzQ-3" value="cgo调用需要注意：&lt;div&gt;go里面cgo阻塞的话，会导致创建线程，并且线程数量不受maxproc的限制&lt;/div&gt;&lt;div&gt;并且go不会主动销毁线程，线程上涨到一定阈值会导致panic&lt;/div&gt;&lt;div&gt;所以需要监控和管理线程数量&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;比较hack的做法：&lt;/div&gt;&lt;div&gt;1.限制线程数量，起一个协程，调用&lt;font style=&quot;font-size: 12px;&quot;&gt;&lt;span style=&quot;white-space: normal; caret-color: rgb(51, 58, 66); color: rgb(51, 58, 66); font-family: &amp;quot;Microsoft YaHei&amp;quot;, Helvetica, Tahoma, Arial, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, sans-serif; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;code style=&quot;white-space: normal; box-sizing: border-box; font-family: Consolas, Monaco, &amp;quot;Andale Mono&amp;quot;, &amp;quot;Ubuntu Mono&amp;quot;, monospace; padding: 0.1em; background: rgb(245, 242, 240); border-radius: 0.3em; line-height: 1.5; word-break: normal; overflow-wrap: normal; tab-size: 4; hyphens: none; text-shadow: white 0px 1px;&quot; class=&quot;language-none&quot;&gt;runtime.LockOSThread，&lt;/code&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;&lt;span style=&quot;white-space: normal; caret-color: rgb(51, 58, 66); color: rgb(51, 58, 66); font-family: &amp;quot;Microsoft YaHei&amp;quot;, Helvetica, Tahoma, Arial, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;WenQuanYi Micro Hei&amp;quot;, sans-serif; background-color: rgb(255, 255, 255);&quot;&gt;但不进行&amp;nbsp;&lt;/span&gt;&lt;code style=&quot;white-space: normal; box-sizing: border-box; font-family: Consolas, Monaco, &amp;quot;Andale Mono&amp;quot;, &amp;quot;Ubuntu Mono&amp;quot;, monospace; padding: 0.1em; background: rgb(245, 242, 240); border-radius: 0.3em; line-height: 1.5; word-break: normal; overflow-wrap: normal; tab-size: 4; hyphens: none; text-shadow: white 0px 1px;&quot; class=&quot;language-none&quot;&gt;runtime.UnlockOSThread，协程退出后会干掉线程&lt;/code&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;code style=&quot;white-space: normal; box-sizing: border-box; font-family: Consolas, Monaco, &amp;quot;Andale Mono&amp;quot;, &amp;quot;Ubuntu Mono&amp;quot;, monospace; padding: 0.1em; background: rgb(245, 242, 240); border-radius: 0.3em; line-height: 1.5; word-break: normal; overflow-wrap: normal; tab-size: 4; hyphens: none; text-shadow: white 0px 1px;&quot; class=&quot;language-none&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/code&gt;&lt;/div&gt;&lt;div&gt;&lt;code style=&quot;white-space: normal; box-sizing: border-box; font-family: Consolas, Monaco, &amp;quot;Andale Mono&amp;quot;, &amp;quot;Ubuntu Mono&amp;quot;, monospace; padding: 0.1em; background: rgb(245, 242, 240); border-radius: 0.3em; line-height: 1.5; word-break: normal; overflow-wrap: normal; tab-size: 4; hyphens: none; text-shadow: white 0px 1px;&quot; class=&quot;language-none&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;2.限制cgo的并发数量，使用一个cpu个数的chan，每次先获取执行权，再调cgo&lt;/font&gt;&lt;/code&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="1" vertex="1">
          <mxGeometry x="2980" y="185" width="460" height="170" as="geometry" />
        </mxCell>
        <mxCell id="fNQkpM3FQFH6w0Id74GZ-1" value="背景：&lt;div style=&quot;&quot;&gt;我们团队是做小说的，大模型这两年很火，然后产品想做大模型的应用，于是和我们的总监一起争取了人力，&lt;/div&gt;&lt;div style=&quot;&quot;&gt;把我们之前组内的大部分人带去做ai工具了，留了两三个下来继续维护小说&lt;/div&gt;&lt;div style=&quot;&quot;&gt;虽然组织架构没变，但是我们做的事情目前完全分开的&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;项目的背景：&lt;/div&gt;&lt;div style=&quot;&quot;&gt;在我们接手前，有一波人内部做了demo了的，没有上线，是之前搜索的同学做的，用python实现的，一个单体服务&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;接手后：&lt;/div&gt;&lt;div style=&quot;&quot;&gt;这个服务经过了我们组前面两个人的手，都反应比较难维护，上线风险很大，其中一个同事跟老板提议重构，&lt;/div&gt;&lt;div style=&quot;&quot;&gt;我们和之前的同学对了下，建议是维持现状，可能老板也没信心短时间重构好，所以暂时决定新需求还是继续在上面开发&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;后面有需求安排到我了：&lt;/div&gt;&lt;div style=&quot;&quot;&gt;我当时先去看了下代码，确实很难维护，大概有一些问题：&lt;/div&gt;&lt;div style=&quot;&quot;&gt;1.代码比较乱，能看出来一开始还是设计的很好的，但是估计后面写着写着就越来越乱了，比如调大模型传的参数，从上层逻辑一路传下去，结果发现底层是写死的，查问题很浪费人力&lt;/div&gt;&lt;div style=&quot;&quot;&gt;2.日志，监控，降级，几乎没有。经常抛异常，定位到很多比如数组边界问题这些&lt;/div&gt;&lt;div style=&quot;&quot;&gt;3.python和我们团队的技术栈不匹配&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;我的想法：&lt;/div&gt;&lt;div style=&quot;&quot;&gt;我看了这个代码后，肯定是想重构的，毕竟太难维护了，但是由于之前那个同事和老板确认过，没有同意，所以我暂时没有直接跟老板说，先支持了一些小需求&lt;/div&gt;&lt;div style=&quot;&quot;&gt;并且，我把大致的几个流程，QA，摘要，速读，划线解读的逻辑都梳理了下。&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;找到重构的机会：&lt;/div&gt;&lt;div style=&quot;&quot;&gt;后面有一个推荐问题的需求，大致逻辑就是让大模型生成针对文章内容的问题，把问题展示个用户，让用户快速提问，并且问题需要做语义上的去重&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;由于之前看了几个流程的实现，所以这里的方案我大致知道怎么做，并且知道哪些是依赖python的，所以我先调研了下，依赖python的这块，能不能单独拎出来在trpc-python里面实现，验证下来是可行的&lt;/div&gt;&lt;div style=&quot;&quot;&gt;所以我去跟老板说了下，把推荐问题这个单独拎出来，有依赖python得计算的，我们在trpc-python里面提供接口，并且跟老板演示了下可行性，所以老板同意了&lt;/div&gt;&lt;div style=&quot;&quot;&gt;于是，这个推荐问题的就单独了出来&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;还有这么多历史逻辑怎么办：&lt;/div&gt;&lt;div style=&quot;&quot;&gt;由于我基本把这里面的逻辑都梳理过了，并且问题模块也通过实践验证了重构的可行性，于是我跟老板提议，其他的QA，摘要，速读，划线解读等都按照问题这种方式重构掉，依赖python的提供接口&lt;/div&gt;&lt;div style=&quot;&quot;&gt;上层业务逻辑用go重写，这次老板答应了，但是由于赶着上线，时间非常紧张，所以重构这个事情，五一申请了加班。并且，老板安排了另外一个同事一起来重构&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;我做了什么：&lt;/div&gt;&lt;div style=&quot;&quot;&gt;我把所有的模块的流程梳理了下，然后把需要拆分到python的进行了拆分，提供了接口，然后重构了QA和划线解读两个的业务逻辑层的代码。&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;阶段性成果：&lt;/div&gt;&lt;div style=&quot;&quot;&gt;在上线前，我们把这块重构完了，监控，日志，告警，降级这些都做了，后面有新的文档类型接入，word的文档，由原来的2-3天工作量降低到几乎半天就能搞定了&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;拆分了什么接口：&lt;/div&gt;&lt;div style=&quot;&quot;&gt;拆分出来后，目前python里面主要负责了几个接口&lt;/div&gt;&lt;div style=&quot;&quot;&gt;1.文档拆分：把文档转token，根据算法同学给的阈值，把长文本根据token拆分成适当的大小（因为给模型的上下文长限制度是按照token算的，不是文本的大小），把短文本进行合并，并且还对表格进行优化，&lt;/div&gt;&lt;div style=&quot;&quot;&gt;比如一个大的表格，可能被拆分成多块，会丢失表头数据，所以做了表头数据的补充。还有一些对表格的描述信息，我们会填充在前面&lt;/div&gt;&lt;div style=&quot;&quot;&gt;2.召回topn的分片：问答的流程，会根据用户的prompt，召回topn的分片，然后给模型进行问答&lt;/div&gt;&lt;div style=&quot;&quot;&gt;3.索引计算：产品场景上会针对回答的内容，进行原文相关的索引展示，所以会有根据回答，计算原文索引的接口&lt;/div&gt;&lt;div style=&quot;&quot;&gt;4.相似度得分计算：这个就是推荐问题在用的&lt;/div&gt;&lt;div style=&quot;&quot;&gt;这里面有几个本地运行的小模型，主要依赖python的tokenizer进行加载，然后计算文本的token，还有一个混元提供的文本转token的库&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;新问题：&lt;/div&gt;&lt;div style=&quot;&quot;&gt;上线后，上层服务基本就是纯业务逻辑的实现，所以基本没什么问题&lt;/div&gt;&lt;div style=&quot;&quot;&gt;python这个服务，基本上是一个cpu密集型的服务了，长文本下拆分逻辑，表现很差，不仅止阻塞当前请求，还由于计算，导致网络io无法及时处理，出现一些长尾请求，验证下来3MB的文档（300w的字符）处理需要30s，等于不可用&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;尝试解决：&lt;/div&gt;&lt;div style=&quot;&quot;&gt;很容易想到，既然计算耗时，那就线程池计算，但是我找了一段逻辑验证了一下，发现不仅没有下降，反而表现不如单线程，所以我仔细了解了下python的运行机制&lt;/div&gt;&lt;div style=&quot;&quot;&gt;原来python有一个GIL全局锁，只有抢到锁的才有执行代码的权限，及时有线程池，在一个时刻也只有一个线程在运行，所以解释了为什么线程池反而效率降低了，多核不但没用起来，反而增加了上下文的切换&lt;/div&gt;&lt;div style=&quot;&quot;&gt;trpc-python通过多进程来利用多核的&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;如何解决：&lt;/div&gt;&lt;div style=&quot;&quot;&gt;1. 耗时点分析：首先我用cprofile对拆分逻辑进行分析，cprofile手python的性能分析工具，可以统计函数的运行耗时，分析下来主要有几个点：1.xml加载4s &amp;nbsp;2.xml转markdown20s &amp;nbsp;3.计算token：5s&lt;/div&gt;&lt;div style=&quot;&quot;&gt;2. 3mb的xml转换耗时4s，同样的文本我用go试了下，200ms内就完成了，相差了20倍，确实是没想到的，网上看了下分析，python的运行效率相比编译型语言比如c/c++，会有2-10倍的差距&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;既然语言效率差距这么大，并且验证也证明了，所以考虑用go进行重写分片逻辑&lt;/div&gt;&lt;div style=&quot;&quot;&gt;针对本地运行的模型怎么办？&lt;/div&gt;&lt;div style=&quot;&quot;&gt;我调研了下tokenizer的库，官方其实是提供了rust版本的，go语言也有，但是使用的人少，就不敢直接用，所以就有了一个思路：把rust编译成动态库，然后go语言通过cgo进行调用，实现一个跨语言的调用&lt;/div&gt;&lt;div style=&quot;&quot;&gt;于是我自己验证了，和python的结果进行了对比，证明了方案可行，并且性能对比了下，100w次计算，性能差距有4倍&lt;/div&gt;&lt;div style=&quot;&quot;&gt;所以验证下来，理论上只有混元那个库无法运行在go里面，其他的都可以重写，或者用cgo进行替换。但是需要注意的是，cgo可能导致线程数量暴涨，因为cgo阻塞的时候，go会创建新的m，保证g及时被调度，所以可能导致线程暴涨&lt;/div&gt;&lt;div style=&quot;&quot;&gt;极端情况下会导致panic，所以这里要考虑限制cgo调用的并发数，&lt;/div&gt;&lt;div style=&quot;&quot;&gt;1.最好是和核心数一致就行，保证一个时刻最多有和核心数一样的cgo在运行。&lt;/div&gt;&lt;div style=&quot;&quot;&gt;2.或者通过比较hack的手段销毁线程，&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;结果：&lt;/div&gt;&lt;div style=&quot;&quot;&gt;1.分片这块刚优化完，目前验证下来，3MB的文件从之前的30s缩短到3s了，从不可用到性能还行，基本上有了质的提升&lt;/div&gt;&lt;div style=&quot;&quot;&gt;2.本地tokenizer的加载，还没优化，目前验证下来也有几乎4倍的提升&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;长远看：&lt;/div&gt;&lt;div style=&quot;&quot;&gt;虽然目前方案解决了可能99.9%的场景的问题，但是本质上来说，并没有根除用户长文本的问题，如果用户就是搞了一个几百兆的文本呢&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;我之前也对比了公司其他团队的方案，同时呢之前也问过上一波的同学&lt;/div&gt;&lt;div style=&quot;&quot;&gt;基本思路：&lt;/div&gt;&lt;div style=&quot;&quot;&gt;其他团队的方案，会在后面挂一个向量数据库，通过向量数据库进行召回&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;我们目前上传，解析，问答其实是一个完全同步的流程，实际上在面对超长文本下，是可以同步改异步的，如果引入向量数据库，或者现有流程异步化&lt;/div&gt;&lt;div style=&quot;&quot;&gt;可以做到：一边拆分文档，一边用户问答，召回的池子在完全解析前，是一个动态的过程，降低问答的效果进行服务，不至于无法响应。&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#6c8ebf;fillColor=#dae8fc;" parent="1" vertex="1">
          <mxGeometry x="950" y="50" width="1250" height="1230" as="geometry" />
        </mxCell>
        <mxCell id="ROHaIBtQBEbf63J--0YB-4" value="&lt;div&gt;背景：&lt;/div&gt;1.团队成员背景，目前主要做AI工具&lt;div&gt;2.项目背景：接手的demo项目&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;项目的情况：&lt;/div&gt;&lt;div&gt;1.经手了两个同事，反馈不好维护&lt;/div&gt;&lt;div&gt;2.有一个同事提议重构，老板找之前的那拨人了解了下，没有同意重构&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;安排了一些相关需求给我：&lt;/div&gt;&lt;div&gt;1.我大致看了下项目代码&lt;/div&gt;&lt;blockquote style=&quot;margin: 0 0 0 40px; border: none; padding: 0px;&quot;&gt;&lt;div&gt;大概有一些问题：&lt;/div&gt;&lt;div&gt;1.代码很乱。能看出来一开始还是好好设计的，但是后面写着估计就越来越乱了，比如之前让修改一个大模型的参数，改了不生效，最后查到很多层参数传递，但是在最底层写死了，导致怎么改都没用、&lt;/div&gt;&lt;div&gt;2.监控，日志，告警，降级机会都没有。经常抛异常，一查很多数组越界这种问题&lt;/div&gt;&lt;div&gt;3.技术栈python和团队不符合&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;2.由于之前老板没同意重构，所以我也暂时没提，先做了几个小需求。但是我内心是想重构的，因为实在太难维护了&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;边做需求边梳理：&lt;/div&gt;&lt;div&gt;1.梳理了文档上传，QA，摘要，速读，划线解读这些流程。画了下流程图，把每个流程依赖python的部分标记了下&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;1.文档上传：文本转token，根据token分片，拆分和合并，表格粘着等逻辑&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;2.QA：根据历史问题prompt改写，搜索增强，召回topn分片，根据回答计算原文索引&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;3.摘要：对文章内容进行总结，底层是一个能支持32k上下文的模型&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;4.划线解读：无上下文相关的问答&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;2.总的来说：&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;1.无python依赖的业务主逻辑，完全可以go实现&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;2.文本转token，索引计算，依赖python或者有本地模型的，无法重构，是纯计算的逻辑（cpu密集）&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;重构的机会：&lt;/div&gt;&lt;div&gt;1.有一个推荐问题的逻辑。大概流程是：大模型根据上下文生成推荐问题，后台进行相似度去重后返回给用户&lt;/div&gt;&lt;div&gt;2.相似度计算这块，我之前都梳理过了，大概实现就是文字转token，再向量化，再计算余弦相似度，基于某个阈值进行去重&lt;/div&gt;&lt;div&gt;3.跟老板提议把这块逻辑拆出去，进行重构，并且我演示了下相似度计算这块的逻辑，所以老板同意了&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;阶段性成果：&lt;/div&gt;&lt;div&gt;1.推荐问题模块完全重构了，只依赖了一个相似度计算，以及拆成了新服务&lt;/div&gt;&lt;div&gt;2.新服务是trpc-python的，监控，日志，耗时这些都不是问题，有了主被调，后面耗时分析也方便了&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;全部接口进行重构：&lt;/div&gt;&lt;div&gt;1.跟老板体验把其他QA，摘要，速读，划线解读，全部进行重构，并且我把流程图跟老板看了下，由于之前推荐问题证明了方案的可行，所以老板同意了&lt;/div&gt;&lt;div&gt;2.当时项目也是赶着上线，所以老板叫上了之前接手过的一个同事，和我一起重构，我把所有接口需要保留到python的拆进去，并且跑通流程&lt;/div&gt;&lt;div&gt;3.拆分完我这边把QA接口和划线解读进行了完整的重构&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;项目得以正常上线：&lt;/div&gt;&lt;div&gt;1.重构后，项目正常上线了&lt;/div&gt;&lt;div&gt;2.之前听老板在多个会议上都肯定了，我们目前项目的稳定性&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;新的问题：&lt;/div&gt;&lt;div&gt;1.python服务从之前无法观测，到现在可以方便定位问题了，新的python也暴露了问题&lt;/div&gt;&lt;div&gt;2.python服务的接口：&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;1.相似度计算和召回topn依赖两种token计算方式，混元提供的（python库的形式），还有是开源的（需要依赖tokeniser加载本地模型）&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;2.文本拆分&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;3.长文本下拆分逻辑耗时严重，由于是cpu密集型的计算，不只是单个请求慢，还会导致网络io无法处理&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;4.一个3mb的文档，需要处理30s，完全无法接受&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;尝试解决：&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space-collapse: preserve;&quot;&gt;1.很容易想到起多线程去计算，但是验证下来发现耗时不减反增。后面了解到是python的GIL锁的机制，导致单进程下就没办法用多核，上线文切换反而导致耗时增加了，trpc-python是多进程来利用多核的&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;其他方案：&lt;/div&gt;&lt;div&gt;分析耗时：&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;1.用cprofile分析了下耗时：&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;1.&lt;/span&gt;3mb的文件，xml解析4s，同样的文本go只要200ms&lt;/span&gt;，相差了20倍&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;2.xml转markdown20s&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;3.token计算5s&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;如何解决：&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;1.分片逻辑重写&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;2.本地模型加载想办法在go里面加载&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;1.重写：目前已经重写完了，线上正在对比两边的拆分结果，采用最长公共子序列计算相似度，设置阈值，查看对比相似的量级&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;30s重写后3s，有10倍的提升&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;2.本地模型加载：&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;通过把rust的tokenizer，编译成动态库，再通过cgo进行加载，对比了下，100w次计算，相差4倍&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;cgo的引入需要防止线程数暴涨&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;长远看：向量数据库&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#9673a6;fillColor=#e1d5e7;" vertex="1" parent="1">
          <mxGeometry x="950" y="-1070" width="1130" height="1050" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="gg-zCY3S3wDtr2VuZ_-A" name="activity">
    <mxGraphModel dx="2133" dy="2036" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="xs7M36CM43rjV9m2G4Hp-72" value="" style="rounded=0;whiteSpace=wrap;html=1;dashed=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="650" y="435" width="360" height="325" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-69" value="" style="rounded=0;whiteSpace=wrap;html=1;dashed=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="-10" y="30" width="580" height="620" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-64" value="" style="rounded=0;whiteSpace=wrap;html=1;dashed=1;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;" parent="1" vertex="1">
          <mxGeometry x="-520" y="280" width="360" height="620" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-1" value="pk服务" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="138" y="320" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-2" value="mysql" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" parent="1" vertex="1">
          <mxGeometry x="138" y="470" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="xs7M36CM43rjV9m2G4Hp-4" target="xs7M36CM43rjV9m2G4Hp-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-4" value="段位赛pk逻辑服务" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="8" y="80" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-67" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="xs7M36CM43rjV9m2G4Hp-5" target="xs7M36CM43rjV9m2G4Hp-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="xs7M36CM43rjV9m2G4Hp-5" target="xs7M36CM43rjV9m2G4Hp-74" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-2" value="创建/结算竞猜" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="ebTP9VvHCpq9uHz0mKpL-1" vertex="1" connectable="0">
          <mxGeometry x="0.2421" y="1" relative="1" as="geometry">
            <mxPoint y="12" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-5" value="" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;rotation=90;" parent="1" vertex="1">
          <mxGeometry x="263" y="465" width="60" height="90" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-6" value="kafka" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="258" y="495" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="xs7M36CM43rjV9m2G4Hp-1" target="xs7M36CM43rjV9m2G4Hp-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-37" value="事务" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="xs7M36CM43rjV9m2G4Hp-7" vertex="1" connectable="0">
          <mxGeometry x="-0.2889" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="xs7M36CM43rjV9m2G4Hp-1" target="xs7M36CM43rjV9m2G4Hp-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-21" value="创建/加分/结算事件" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="xs7M36CM43rjV9m2G4Hp-8" vertex="1" connectable="0">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="xs7M36CM43rjV9m2G4Hp-10" target="xs7M36CM43rjV9m2G4Hp-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-10" value="吃鸡pk逻辑" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="138" y="80" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="xs7M36CM43rjV9m2G4Hp-11" target="xs7M36CM43rjV9m2G4Hp-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-18" value="匹配/特殊场景外部开启pk" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="xs7M36CM43rjV9m2G4Hp-14" vertex="1" connectable="0">
          <mxGeometry x="0.6387" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-11" value="年度盛典等" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="268" y="80" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-25" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="xs7M36CM43rjV9m2G4Hp-22" target="xs7M36CM43rjV9m2G4Hp-24" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-22" value="通用榜单写" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="680" y="480" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-24" value="redis" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" parent="1" vertex="1">
          <mxGeometry x="790" y="650" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-27" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="xs7M36CM43rjV9m2G4Hp-26" target="xs7M36CM43rjV9m2G4Hp-24" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-29" value="各种时间维度的榜单&lt;div&gt;小时/日/周/月榜&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="xs7M36CM43rjV9m2G4Hp-27" vertex="1" connectable="0">
          <mxGeometry x="0.69" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-26" value="通用榜单读" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="850" y="480" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-32" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="xs7M36CM43rjV9m2G4Hp-30" target="xs7M36CM43rjV9m2G4Hp-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-30" value="pk各种场景的榜单统计" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="400" y="480" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-35" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="xs7M36CM43rjV9m2G4Hp-33" target="xs7M36CM43rjV9m2G4Hp-24" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-36" value="对账" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="xs7M36CM43rjV9m2G4Hp-35" vertex="1" connectable="0">
          <mxGeometry x="-0.12" y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-33" value="mysql" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" parent="1" vertex="1">
          <mxGeometry x="680" y="650" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-34" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="xs7M36CM43rjV9m2G4Hp-22" target="xs7M36CM43rjV9m2G4Hp-33" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-39" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;" parent="1" source="xs7M36CM43rjV9m2G4Hp-1" target="xs7M36CM43rjV9m2G4Hp-1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="298" y="335" />
              <mxPoint x="298" y="365" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-40" value="&lt;span style=&quot;caret-color: rgba(0, 0, 0, 0); color: rgba(0, 0, 0, 0); font-family: monospace; font-size: 0px; text-align: start; background-color: rgb(251, 251, 251);&quot;&gt;%3CmxGraphModel%3E%3Croot%3E%3CmxCell%20id%3D%220%22%2F%3E%3CmxCell%20id%3D%221%22%20parent%3D%220%22%2F%3E%3CmxCell%20id%3D%222%22%20value%3D%22%E5%88%9B%E5%BB%BA%2F%E7%BB%93%E7%AE%97%22%20style%3D%22edgeLabel%3Bhtml%3D1%3Balign%3Dcenter%3BverticalAlign%3Dmiddle%3Bresizable%3D0%3Bpoints%3D%5B%5D%3B%22%20vertex%3D%221%22%20connectable%3D%220%22%20parent%3D%221%22%3E%3CmxGeometry%20x%3D%2249%22%20y%3D%22350%22%20as%3D%22geometry%22%2F%3E%3C%2FmxCell%3E%3C%2Froot%3E%3C%2FmxGraphModel%&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="xs7M36CM43rjV9m2G4Hp-39" vertex="1" connectable="0">
          <mxGeometry y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-41" value="创建/结算" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="1" vertex="1" connectable="0">
          <mxGeometry x="298" y="350" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-68" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="xs7M36CM43rjV9m2G4Hp-42" target="xs7M36CM43rjV9m2G4Hp-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-42" value="" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;rotation=90;" parent="1" vertex="1">
          <mxGeometry x="-110" y="300" width="60" height="100" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-43" value="kafka" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="-120" y="335" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-61" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="xs7M36CM43rjV9m2G4Hp-45" target="xs7M36CM43rjV9m2G4Hp-49" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-45" value="送礼服务" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-380" y="320" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-47" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="xs7M36CM43rjV9m2G4Hp-45" target="xs7M36CM43rjV9m2G4Hp-42" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-59" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;" parent="1" source="xs7M36CM43rjV9m2G4Hp-49" target="xs7M36CM43rjV9m2G4Hp-52" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-60" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;" parent="1" source="xs7M36CM43rjV9m2G4Hp-49" target="xs7M36CM43rjV9m2G4Hp-54" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-49" value="支付网关" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-380" y="510" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-50" value="包裹&lt;div&gt;mysql&lt;/div&gt;" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" parent="1" vertex="1">
          <mxGeometry x="-440" y="770" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-53" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="xs7M36CM43rjV9m2G4Hp-52" target="xs7M36CM43rjV9m2G4Hp-50" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-52" value="自运营包裹服务" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-470" y="630" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-58" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="xs7M36CM43rjV9m2G4Hp-54" target="xs7M36CM43rjV9m2G4Hp-57" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-54" value="公司的米大师" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-310" y="630" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-57" value="tdsql" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" parent="1" vertex="1">
          <mxGeometry x="-280" y="770" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-65" value="送礼相关" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="-520" y="280" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-70" value="pk相关" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="-10" y="30" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-73" value="榜单" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="650" y="435" width="70" height="25" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-75" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="xs7M36CM43rjV9m2G4Hp-74" target="xs7M36CM43rjV9m2G4Hp-49" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-80" y="750" />
              <mxPoint x="-80" y="540" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="d5rrUPnheSEeBodwmt4X-1" value="资金池设计&lt;div&gt;保证不超发&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="xs7M36CM43rjV9m2G4Hp-75" vertex="1" connectable="0">
          <mxGeometry x="-0.2668" y="-3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-79" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.75;entryDx=0;entryDy=0;" parent="1" source="xs7M36CM43rjV9m2G4Hp-74" target="xs7M36CM43rjV9m2G4Hp-22" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="620" y="630" as="targetPoint" />
            <Array as="points">
              <mxPoint x="600" y="750" />
              <mxPoint x="600" y="525" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-74" value="竞猜服务" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="232" y="730" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-76" value="mysql" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" parent="1" vertex="1">
          <mxGeometry x="337" y="900" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-77" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="xs7M36CM43rjV9m2G4Hp-74" target="xs7M36CM43rjV9m2G4Hp-76" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-83" value="对账" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="xs7M36CM43rjV9m2G4Hp-80" target="xs7M36CM43rjV9m2G4Hp-76" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-80" value="redis" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" parent="1" vertex="1">
          <mxGeometry x="189" y="900" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="xs7M36CM43rjV9m2G4Hp-82" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="xs7M36CM43rjV9m2G4Hp-74" target="xs7M36CM43rjV9m2G4Hp-80" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="ebTP9VvHCpq9uHz0mKpL-3" target="xs7M36CM43rjV9m2G4Hp-45" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-5" value="送礼" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="ebTP9VvHCpq9uHz0mKpL-4" vertex="1" connectable="0">
          <mxGeometry x="-0.0657" y="3" relative="1" as="geometry">
            <mxPoint y="-1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-3" value="" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shadow=0;dashed=0;strokeWidth=1;shape=mxgraph.android.phone2;strokeColor=#c0c0c0;" parent="1" vertex="1">
          <mxGeometry x="-345.64" y="50" width="51.28" height="100" as="geometry" />
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.75;entryDx=0;entryDy=0;" parent="1" source="ebTP9VvHCpq9uHz0mKpL-7" target="xs7M36CM43rjV9m2G4Hp-74" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-9" value="下注" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="ebTP9VvHCpq9uHz0mKpL-8" vertex="1" connectable="0">
          <mxGeometry x="0.0057" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-7" value="" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shadow=0;dashed=0;strokeWidth=1;shape=mxgraph.android.phone2;strokeColor=#c0c0c0;" parent="1" vertex="1">
          <mxGeometry x="598.72" y="850" width="51.28" height="100" as="geometry" />
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="ebTP9VvHCpq9uHz0mKpL-10" target="xs7M36CM43rjV9m2G4Hp-26" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-12" value="拉榜单" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="ebTP9VvHCpq9uHz0mKpL-11" vertex="1" connectable="0">
          <mxGeometry x="0.0048" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-10" value="" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shadow=0;dashed=0;strokeWidth=1;shape=mxgraph.android.phone2;strokeColor=#c0c0c0;" parent="1" vertex="1">
          <mxGeometry x="884.36" y="210" width="51.28" height="100" as="geometry" />
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ebTP9VvHCpq9uHz0mKpL-13" target="xs7M36CM43rjV9m2G4Hp-4" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="198" y="-10" />
              <mxPoint x="68" y="-10" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ebTP9VvHCpq9uHz0mKpL-13" target="xs7M36CM43rjV9m2G4Hp-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="ebTP9VvHCpq9uHz0mKpL-13" target="xs7M36CM43rjV9m2G4Hp-11" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="198" y="-10" />
              <mxPoint x="328" y="-10" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-18" value="发起pk" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="ebTP9VvHCpq9uHz0mKpL-17" vertex="1" connectable="0">
          <mxGeometry x="-0.7828" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ebTP9VvHCpq9uHz0mKpL-13" value="" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shadow=0;dashed=0;strokeWidth=1;shape=mxgraph.android.phone2;strokeColor=#c0c0c0;" parent="1" vertex="1">
          <mxGeometry x="172.36" y="-170" width="51.28" height="100" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="NUvMHLy74Mf8xs66AC7l" name="第 5 页">
    <mxGraphModel dx="2133" dy="867" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="IDojizpqGfUpgZ52IpqX-24" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-120" y="50" width="1150" height="390" as="geometry" />
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;" edge="1" parent="1" source="IDojizpqGfUpgZ52IpqX-1" target="IDojizpqGfUpgZ52IpqX-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-5" value="leader心跳超时" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="IDojizpqGfUpgZ52IpqX-4">
          <mxGeometry x="-0.0333" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-1" value="follower&lt;div&gt;跟随者&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="90" y="220" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;" edge="1" parent="1" source="IDojizpqGfUpgZ52IpqX-2" target="IDojizpqGfUpgZ52IpqX-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-8" value="收到半数以上投票" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="IDojizpqGfUpgZ52IpqX-7">
          <mxGeometry x="0.0667" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.25;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="IDojizpqGfUpgZ52IpqX-2" target="IDojizpqGfUpgZ52IpqX-1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="340" y="320" />
              <mxPoint x="120" y="320" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-14" value="发现更新的选举者" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="IDojizpqGfUpgZ52IpqX-13">
          <mxGeometry relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-2" value="candidate&lt;div&gt;选举者&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="310" y="220" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.75;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="IDojizpqGfUpgZ52IpqX-3" target="IDojizpqGfUpgZ52IpqX-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-12" value="有更新的选举者，term更大" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="IDojizpqGfUpgZ52IpqX-11">
          <mxGeometry x="0.008" y="-4" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=0;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;dashed=1;" edge="1" parent="1" source="IDojizpqGfUpgZ52IpqX-3" target="IDojizpqGfUpgZ52IpqX-1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="640" y="110" />
              <mxPoint x="180" y="110" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-18" value="定期发送心跳，保证leader的地位" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="IDojizpqGfUpgZ52IpqX-17">
          <mxGeometry y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-22" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="IDojizpqGfUpgZ52IpqX-3" target="IDojizpqGfUpgZ52IpqX-1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="700" y="390" />
              <mxPoint x="90" y="390" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-23" value="日志复制给所有跟随者，半数以上确认则回复客户端" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="IDojizpqGfUpgZ52IpqX-22">
          <mxGeometry x="-0.0024" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-3" value="leader&lt;div&gt;主&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="610" y="220" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=0;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="IDojizpqGfUpgZ52IpqX-2" target="IDojizpqGfUpgZ52IpqX-2">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="340" y="170" />
              <mxPoint x="400" y="170" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-10" value="选举超时" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="IDojizpqGfUpgZ52IpqX-9">
          <mxGeometry x="-0.025" y="4" relative="1" as="geometry">
            <mxPoint x="2" y="4" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-15" value="" style="shape=flexArrow;endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-10" y="250" as="sourcePoint" />
            <mxPoint x="70" y="250" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-16" value="开始" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="5" y="198" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="IDojizpqGfUpgZ52IpqX-19" target="IDojizpqGfUpgZ52IpqX-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-21" value="提交日志" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="IDojizpqGfUpgZ52IpqX-20">
          <mxGeometry x="0.0154" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-19" value="client" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="860" y="220" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="IDojizpqGfUpgZ52IpqX-25" value="raft" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="-120" y="50" width="90" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="B7_l87_Xbevseyv3yegD" name="网络">
    <mxGraphModel dx="1536" dy="2189" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-1" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="210" y="160" width="480" height="400" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-31" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0;exitDx=0;exitDy=0;" edge="1" parent="1" source="XoVVz6Dzr-mfjlHxSKAl-2" target="XoVVz6Dzr-mfjlHxSKAl-5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-2" value="源端口" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="210" y="160" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-3" value="目的端口" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="160" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-5" value="0" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="195" y="-430" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-6" value="31" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="670" y="-430" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-7" value="seq" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="210" y="220" width="480" height="50" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-8" value="ack" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="210" y="270" width="480" height="50" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="XoVVz6Dzr-mfjlHxSKAl-9">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="150" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-9" value="Data&lt;div&gt;offset&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="210" y="320" width="60" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-10" value="3" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="255" y="-430" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-13" value="tcp的头部是变长的&lt;div&gt;需要标记数据的位置&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#666666;fillColor=#f5f5f5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="20" y="330" width="130" height="40" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-14" value="&lt;span style=&quot;caret-color: rgb(31, 35, 40); color: rgb(31, 35, 40); font-family: -apple-system, BlinkMacSystemFont, &amp;quot;Segoe UI&amp;quot;, &amp;quot;Noto Sans&amp;quot;, Helvetica, Arial, sans-serif, &amp;quot;Apple Color Emoji&amp;quot;, &amp;quot;Segoe UI Emoji&amp;quot;; text-align: left; background-color: rgb(255, 255, 255);&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;Reserved&lt;/font&gt;&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="270" y="320" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-15" value="U&lt;div&gt;R&lt;/div&gt;&lt;div&gt;G&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="387" y="320" width="11" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-17" value="A&lt;div&gt;C&lt;/div&gt;&lt;div&gt;K&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="398" y="320" width="11" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-18" value="P&lt;div&gt;S&lt;/div&gt;&lt;div&gt;H&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="409" y="320" width="11" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-20" value="P&lt;div&gt;S&lt;/div&gt;&lt;div&gt;T&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="420" y="320" width="10" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-21" value="S&lt;div&gt;Y&lt;/div&gt;&lt;div&gt;N&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="430" y="320" width="10" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-23" value="F&lt;div&gt;I&lt;/div&gt;&lt;div&gt;N&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="440" y="320" width="10" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-24" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;font face=&quot;-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji&quot; color=&quot;#1f2328&quot;&gt;&lt;span style=&quot;caret-color: rgb(31, 35, 40);&quot;&gt;Windows&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="320" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-25" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;font face=&quot;-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji&quot; color=&quot;#1f2328&quot;&gt;&lt;span style=&quot;caret-color: rgb(31, 35, 40);&quot;&gt;checksum&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;caret-color: rgba(0, 0, 0, 0); color: rgba(0, 0, 0, 0); font-family: monospace; font-size: 0px; white-space: nowrap;&quot;&gt;%3CmxGraphModel%3E%3Croot%3E%3CmxCell%20id%3D%220%22%2F%3E%3CmxCell%20id%3D%221%22%20parent%3D%220%22%2F%3E%3CmxCell%20id%3D%222%22%20value%3D%22%26lt%3Bdiv%20style%3D%26quot%3Btext-align%3A%20left%3B%26quot%3B%26gt%3B%26lt%3Bfont%20face%3D%26quot%3B-apple-system%2C%20BlinkMacSystemFont%2C%20Segoe%20UI%2C%20Noto%20Sans%2C%20Helvetica%2C%20Arial%2C%20sans-serif%2C%20Apple%20Color%20Emoji%2C%20Segoe%20UI%20Emoji%26quot%3B%20color%3D%26quot%3B%231f2328%26quot%3B%26gt%3B%26lt%3Bspan%20style%3D%26quot%3Bcaret-color%3A%20rgb(31%2C%2035%2C%2040)%3B%26quot%3B%26gt%3BWindows%26lt%3B%2Fspan%26gt%3B%26lt%3B%2Ffont%26gt%3B%26lt%3B%2Fdiv%26gt%3B%22%20style%3D%22rounded%3D0%3BwhiteSpace%3Dwrap%3Bhtml%3D1%3B%22%20vertex%3D%221%22%20parent%3D%221%22%3E%3CmxGeometry%20x%3D%22450%22%20y%3D%22320%22%20width%3D%22240%22%20height%3D%2260%22%20as%3D%22geometry%22%2F%3E%3C%2FmxCell%3E%3C%2Froot%3E%3C%2FmxGraphModel%3E&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="210" y="380" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-26" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;font face=&quot;-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji&quot; color=&quot;#1f2328&quot;&gt;&lt;span style=&quot;caret-color: rgb(31, 35, 40);&quot;&gt;Urgent Pointer&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="380" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-27" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;font face=&quot;-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji&quot; color=&quot;#1f2328&quot;&gt;&lt;span style=&quot;caret-color: rgb(31, 35, 40);&quot;&gt;Options&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="210" y="440" width="310" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-28" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;font face=&quot;-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji&quot; color=&quot;#1f2328&quot;&gt;&lt;span style=&quot;caret-color: rgb(31, 35, 40);&quot;&gt;padding&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="520" y="440" width="170" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-30" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;font face=&quot;-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji&quot; color=&quot;#1f2328&quot;&gt;&lt;span style=&quot;caret-color: rgb(31, 35, 40);&quot;&gt;data&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="210" y="500" width="480" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1.1;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="XoVVz6Dzr-mfjlHxSKAl-3" target="XoVVz6Dzr-mfjlHxSKAl-6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-34" value="option" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="210" y="100" width="480" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-35" value="目的地址" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="210" y="40" width="480" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-36" value="源地址" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="210" y="-20" width="480" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-37" value="源地址" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="210" y="-80" width="480" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-42" value="头部校验和" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="450" y="-140" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-43" value="生存时间" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="210" y="-140" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-45" value="协议代码" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="330" y="-140" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-46" value="重组标识" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="210" y="-200" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-48" value="标识" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="450" y="-200" width="70" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-49" value="段偏移量" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="520" y="-200" width="170" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-52" value="版本" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="210" y="-260" width="60" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-50" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0;exitDx=0;exitDy=0;dashed=1;" edge="1" parent="1" source="XoVVz6Dzr-mfjlHxSKAl-9" target="XoVVz6Dzr-mfjlHxSKAl-10">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="270" y="-410" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-53" value="头长" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="270" y="-260" width="60" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-54" value="服务类型" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="330" y="-260" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XoVVz6Dzr-mfjlHxSKAl-55" value="包裹总长" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="450" y="-260" width="240" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
